{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"\u6982\u8ff0","text":""},{"location":"#1","title":"1. \u4f7f\u7528\u524d\u5fc5\u8bfb","text":"<p>\u8bf7\u8ba4\u771f\u9605\u8bfb\u672c\u6307\u5357</p> <p>\u8fd9\u662f\u4e00\u4efd AIR \u8ba1\u7b97\u8d44\u6e90\u7684\u4f7f\u7528\u6307\u5357\uff0c\u5176\u4e2d\u5305\u62ec\u4e86\u82e5\u5e72\u6ce8\u610f\u4e8b\u9879\u548c\u547d\u4ee4\u5e2e\u52a9\u3002 \u4e3a\u4e86\u670d\u52a1\u5668\u7684\u7a33\u5b9a\u8fd0\u884c\u4ee5\u53ca\u4f7f\u7528\u8005\u7684\u6570\u636e\u5b89\u5168\uff0c\u8bf7\u5404\u4f4d\u7528\u6237\u8ba4\u771f\u9605\u8bfb\u3002 \u5982\u679c\u53d1\u73b0\u672c\u6307\u5357\u4e2d\u7684\u758f\u6f0f\u4e4b\u5904\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\uff0c\u6216\u70b9\u51fb\u53f3\u4e0a\u89d2\u94fe\u63a5\u8fdb\u5165 GitHub \u63d0\u4ea4 issue \u6216 pull request \u3002</p> <p>\u4e0d\u8981\u7740\u6025\u4f7f\u7528</p> <p>\u8bf7\u9605\u8bfb \u6ce8\u610f\u4e8b\u9879 \u3002</p>"},{"location":"#2-updates","title":"2. Updates","text":"<p>2022.06.21 \u66f4\u65b0\uff1a</p> <ul> <li>10.0.0.14 \u4e0a VNC \u7684\u76f8\u5173\u4f7f\u7528\u8bf4\u660e</li> </ul> <p>2022.02.16 \u66f4\u65b0\uff1a</p> <ul> <li>\u5b58\u50a8\u673a\u8f6f\u914d\u989d\u4e0e\u786c\u914d\u989d\u5206\u522b\u8c03\u6574\u4e3a <code>9216G</code> \u4e0e <code>10240G</code> \uff0c\u8d85\u8fc7\u8f6f\u914d\u989d\u4e4b\u540e\u7684\u8c03\u6574\u65f6\u95f4\u964d\u4f4e\u4e3a 3 \u5929</li> <li>\u6587\u6863\u6dfb\u52a0\u4e86\u5927\u91cf Slurm \u7cfb\u7edf\u7684\u6982\u5ff5\u89e3\u91ca\uff0c\u4f7f\u7528\u65b9\u6cd5\u793a\u4f8b</li> <li>Slurm \u7cfb\u7edf\u91c7\u7528\u65b0\u7684\u8d44\u6e90\u4f7f\u7528\u9650\u5236\u65b9\u5f0f\uff1a\u7d2f\u8ba1\u8d44\u6e90\u4f7f\u7528\u65f6\u4e0e\u5f53\u524d\u8d44\u6e90\u4f7f\u7528\u65f6\uff0c\u539f\u6709\u7684 GPU \u4f7f\u7528\u6570\u91cf\uff0c\u4efb\u52a1\u8fd0\u884c\u6570\u91cf\u4e0e\u4efb\u52a1\u8fd0\u884c\u65f6\u95f4\u7684\u9650\u5236\u53d6\u6d88\u3002\u5177\u4f53\u6587\u6863\u8bf4\u660e\u8bf7\u89c1\u8fd9\u91cc</li> <li>VPN \u7cfb\u7edf\u5373\u5c06\u542f\u7528\uff0c\u8bf7\u5404\u4f4d\u7528\u6237\u63d0\u524d\u719f\u6089 VPN \u4f7f\u7528\u65b9\u5f0f</li> </ul> <p>2022.02.11 \u66f4\u65b0\uff1a</p> <ul> <li>\u5b58\u50a8\u673a\u5b8c\u6210\u6269\u5bb9\uff0c\u5404\u7ec4\u78c1\u76d8\u4f7f\u7528\u8f6f\u914d\u989d\u4e0e\u786c\u914d\u989d\u5206\u522b\u8c03\u6574\u4e3a <code>7168G</code> \u4e0e <code>8192G</code></li> <li><code>CUDA Toolkit</code> \u9ed8\u8ba4\u7248\u672c\u5347\u7ea7\u4e3a <code>11.6</code> \uff0c\u4e0e\u6b64\u540c\u65f6 <code>/usr/local</code> \u76ee\u5f55\u4e0b\u4fdd\u7559 <code>11.1</code>\uff0c <code>11.4</code>\uff0c <code>11.5</code> \u7248\u672c</li> </ul> <p>2022.01.18 \u66f4\u65b0\uff1a</p> <ul> <li>\u52a0\u5165 VPN \u7cfb\u7edf\u4f7f\u7528\u8bf4\u660e\u3002\u4e3a\u4fdd\u62a4\u8d44\u6e90\u4e0d\u88ab\u653b\u51fb\uff0c2022\u5e742\u67087\u65e5\u8d77\u96c6\u7fa4\u8d44\u6e90\u5c06\u53ea\u80fd\u901a\u8fc7 VPN \u8bbf\u95ee</li> </ul> <p>2022.01.04 \u66f4\u65b0\uff1a</p> <ul> <li>\u6bcf\u4e2a\u7528\u6237\u5728\u96c6\u7fa4\u4e2d\u6700\u591a\u540c\u65f6\u8fd0\u884c\u4efb\u52a1\u6570\u91cf\u8c03\u6574\u4e3a 6 \u4e2a</li> </ul> <p>2021.12.17 \u66f4\u65b0\uff1a</p> <ul> <li>\u4efb\u52a1\u8fd0\u884c\u65f6\u95f4\u4e0a\u9650\u8c03\u6574\u4e3a 5 \u5929</li> </ul> <p>2021.12.04 \u66f4\u65b0\uff1a</p> <ul> <li>\u652f\u6301\u4efb\u52a1\u5f00\u59cb\u8fd0\u884c\u3001\u7ed3\u675f\u8fd0\u884c\u65f6\uff0c\u901a\u8fc7\u90ae\u4ef6\u901a\u77e5\u7528\u6237\uff0c\u5982\u9700\u4f7f\u7528\u8bf7\u53c2\u8003\u8fd9\u91cc</li> </ul> <p>2021.11.30 \u66f4\u65b0\uff1a</p> <ul> <li>\u6240\u6709\u8282\u70b9\u5747\u5df2\u6dfb\u52a0\u5bb9\u5668\u5e94\u7528\u652f\u6301</li> <li>\u6dfb\u52a0\u8d44\u6e90\u4f7f\u7528\u9650\u5236\uff1a\u5355\u4e2a\u7528\u6237\u5360\u7528GPU\u6570\u91cf\u6700\u591a\u4e3a 8 \u5f20</li> </ul> <p>2021.11.27 \u66f4\u65b0\uff1a</p> <ul> <li>\u4efb\u52a1\u8fd0\u884c\u65f6\u95f4\u4e0a\u9650\u8c03\u6574\u4e3a 3 \u5929\uff0c\u7528\u6237\u8fd0\u884c\u4efb\u52a1\u4e0a\u9650\u4e3a 4 \u4e2a\uff08\u961f\u5217\u4e2d\u4efb\u52a1\u6570\u91cf\u65e0\u9650\u5236\uff09\u3002\u5982\u6709\u7279\u6b8a\u9700\u6c42\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458</li> <li>\u5df2\u5728 <code>air-node-01</code> \u4e0e <code>air-node-03</code> \u4e0a\u6dfb\u52a0\u5bb9\u5668\u8fd0\u884c\u652f\u6301\uff0c\u5982\u9700\u4f7f\u7528\u8bf7\u53c2\u8003\u8fd9\u91cc</li> </ul>"},{"location":"#3","title":"3. \u670d\u52a1\u5668\u67b6\u6784","text":""},{"location":"admin/","title":"\u8fd0\u7ef4\u5907\u5fd8","text":""},{"location":"admin/#denyhosts","title":"Denyhosts","text":"<p>\u89e3\u9664IP\u5c01\u7981\uff1a</p> <ul> <li>\u5c06\u5f85\u89e3\u9664IP\u5730\u5740\u5217\u5165<code>WORK_DIR/allowed-hosts</code></li> <li>AIR3\u4e0a<code>WORK_DIR</code>\u4e3a<code>/var/lib/denyhosts</code></li> </ul>"},{"location":"admin/#processes","title":"Processes","text":"<p>\u6839\u636ePID\u67e5\u770b\u5de5\u4f5c\u76ee\u5f55\uff1a</p> <ul> <li><code>pwdx [PID]</code></li> </ul>"},{"location":"admin/#pytorch-wheel","title":"Pytorch wheel \u4e0b\u8f7d\u5730\u5740","text":"<p>https://download.pytorch.org/whl/torch_stable.html</p>"},{"location":"backup/","title":"Backup","text":"<pre><code>graph LR;\nclassDef className fill:#f9f,stroke:#333,stroke-width:4px;\n    subgraph sA[Cluster];\n        A[[air-server]];\n\n        B1[[air-node-01]];\n        B1_desc{{4 * A100-80G}};\n\n        B[[air-node-02]];\n        B_desc{{8 * A100}};\n\n        C[[air-node-03]];\n        C_desc{{8 * A100}};\n\n        D[[air-node-04]];\n        D_desc{{6 * A100}};\n\n        D1[[air-node-05]];\n        D1_desc{{8 * A100}};\n\n        D2[[air-node-06]];\n        D2_desc{{4 * A100-80G}};\n\n        D3[[air-node-07]];\n        D3_desc{{4 * A100-80G}};\n\n        D4[[air-node-08]];\n        D4_desc{{4 * A100-80G}};\n\n        D5[[air-node-09]];\n        D5_desc{{4 * A100-80G}};\n\n        D6[[air-node-10]];\n        D6_desc{{4 * A100-80G}};\n\n\n        E[(air-storage)];\n        Z[[air-debug-1]];\n\n        G{{2 * A100}};\n\n\n        subgraph sB[Slurm System]\n            A===&gt;|slurm|B1;\n            A===&gt;|slurm|B;\n            A==&gt;|slurm|C;\n            A==&gt;|slurm|D;\n            A==&gt;|slurm|D1;\n            A==&gt;|slurm|D2;\n            A==&gt;|slurm|D3;\n            A==&gt;|slurm|D4;\n            A==&gt;|slurm|D5;\n            A==&gt;|slurm|D6;\n\n            B1===B1_desc\n            B===B_desc;\n            C===C_desc;\n            D===D_desc;\n            D1===D1_desc;\n            D2===D2_desc;\n            D3===D3_desc;\n            D4===D4_desc;\n            D5===D5_desc;\n            D6===D6_desc;\n\n        end\n\n        B1----|nfs|E;\n        A----|nfs|E;\n        B----|nfs|E;\n        C----|nfs|E;\n        D----|nfs|E;\n        D1----|nfs|E;\n        D2----|nfs|E;\n        D3----|nfs|E;\n        D4----|nfs|E;\n        D5----|nfs|E;\n        D6----|nfs|E;\n\n\n\n    F([VPN]);\n    Z===G;\n    Z----|nfs|E;\n    F-.-|10.0.0.251|A;\n    F-.-|10.0.0.242|Z;\n    end\n    T((User));\n    T--&gt;|103.242.175.254|F;\n    style sA fill:#EED,stroke:#DDD;\n    style sB fill:#DEE;</code></pre>"},{"location":"basis/","title":"\u6ce8\u610f\u4e8b\u9879","text":""},{"location":"basis/#1-slurm-gpu","title":"1. \u901a\u8fc7 Slurm \u7cfb\u7edf\u4f7f\u7528 GPU \u8d44\u6e90\uff01","text":"<p>\u8bf7\u53c2\u8003\u8fd9\u91cc\u3002</p>"},{"location":"basis/#2","title":"2. \u78c1\u76d8\u914d\u989d","text":"<p>\u670d\u52a1\u5668\u90e8\u7f72\u4e86\u4e2d\u5fc3\u5316\u7684\u5b58\u50a8\u8282\u70b9 <code>air-storage</code> \uff0c\u5e76\u901a\u8fc7NFS\u6302\u8f7d\u5728\u6240\u6709\u673a\u5668\u7684 <code>/home</code> \u76ee\u5f55\u4e0b\u3002</p> <p>\u76ee\u524d\uff0c\u5404\u4e2a\u5b9e\u9a8c\u5ba4\u5728\u4f7f\u7528\u5b58\u50a8\u65f6\u5747\u6709 <code>9216G</code> \u7684\u8f6f\u914d\u989d\u4e0e <code>10240G</code> \u7684\u786c\u914d\u989d\u3002\u5f53\u5b58\u50a8\u4f7f\u7528\u91cf\u8d85\u8fc7\u8f6f\u914d\u989d\u65f6\uff0c\u6709 3 \u5929\u7684\u8fc7\u6e21\u65f6\u95f4\u5c06\u5b58\u50a8\u4f7f\u7528\u91cf\u4e0b\u964d\u5230\u914d\u989d\u5185\uff1b\u5f53\u5b58\u50a8\u4f7f\u7528\u91cf\u8d85\u8fc7\u8f6f\u914d\u989d 3 \u5929\uff0c\u6216\u5b58\u50a8\u4f7f\u7528\u91cf\u8d85\u8fc7\u786c\u914d\u989d\uff0c\u7528\u6237\u5c06\u4e0d\u80fd\u518d\u5411\u78c1\u76d8\u5199\u5165\u66f4\u591a\u6570\u636e\u3002</p> <pre><code># \u67e5\u770b\u5f53\u524d\u7528\u6237\u7ec4\u7684\u78c1\u76d8\u914d\u989d\nssh air-storage quota -gs\n</code></pre>"},{"location":"basis/#3","title":"3. \u63d0\u9192","text":""},{"location":"basis/#31","title":"3.1 \u505a\u597d\u5b95\u673a\u53d1\u751f\u7684\u51c6\u5907","text":"<p>\u6211\u4eec\u5c3d\u53ef\u80fd\u4fdd\u8bc1\u670d\u52a1\u5668\u9ad8\u53ef\u7528\u8fd0\u884c\uff0c\u670d\u52a1\u5668\u4ecd\u7136\u6709\u6781\u5c0f\u6982\u7387\u5b95\u673a\u3002</p> <p>\u4e3a\u4e86\u5b9e\u9a8c\u6570\u636e\u4ee5\u53ca\u8fdb\u5ea6\u7684\u5b89\u5168\uff0c\u8bf7\u505a\u597d\u5305\u62ec\u4f46\u4e0d\u9650\u4e8e\u4ee5\u4e0b\u51e0\u79cd\u51c6\u5907\uff1a</p> <ol> <li>\u4f7f\u7528 GitHub \u7b49\u5e73\u53f0\u4e91\u7aef\u6258\u7ba1\u4ee3\u7801\uff0c\u9632\u6b62\u786c\u76d8\u635f\u574f\u9020\u6210\u4ee3\u7801\u4e22\u5931\u3002</li> <li>\u5728\u8dd1\u5b9e\u9a8c\u65f6\u9002\u5ea6\u4fdd\u5b58 checkpoints \uff0c\u4ee5\u5728\u5b95\u673a\u7b49\u610f\u5916\u53d1\u751f\u4e4b\u540e\u80fd\u5feb\u901f\u6062\u590d\u5230\u4e4b\u524d\u7684\u5b9e\u9a8c\u72b6\u6001\u3002</li> </ol>"},{"location":"basis/#32","title":"3.2 \u914d\u7f6e\u865a\u62df\u73af\u5883","text":"<p>\u4e3a\u4e86\u670d\u52a1\u5668\u5e73\u7a33\u8fd0\u884c\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\u5b89\u88c5 <code>apt</code> \u6e90\u4e2d\u7684\u8f6f\u4ef6\u5305\u3002</p> <p>\u5e38\u7528 Python \u73af\u5883\u4f9d\u8d56\u53ef\u4ee5\u901a\u8fc7\u521b\u5efa conda \u73af\u5883\u6765\u6ee1\u8db3\uff1b\u7528\u6237\u53ef\u4ee5\u5728\u865a\u62df\u73af\u5883\u4e2d\u901a\u8fc7 <code>conda</code> \u6216 <code>pip</code> \u5b89\u88c5\u6240\u9700\u7684 Python \u4f9d\u8d56\u3002</p> <p>NVIDIA GPU \u5e95\u5c42\u9a71\u52a8\u4ee5\u53ca CUDA Toolkit \u5df2\u7ecf\u5b89\u88c5\u597d\u4e86\u3002\u9075\u5faa\u4e00\u822c\u60ef\u4f8b\uff0c CUDA \u7684\u5b89\u88c5\u8def\u5f84\u5728 <code>/usr/local</code> \u4e0b\uff0c\u5982 <code>/usr/local/cuda</code> \uff08\u9ed8\u8ba4\u7248\u672c\uff09\uff0c\u6216\u8005 <code>/usr/local/cuda11.1</code> \uff08\u7279\u5b9a\u7248\u672c\uff09\u3002\u4f7f\u7528\u65f6\u53ea\u9700\u6839\u636e\u8fd9\u4e2a\u8def\u5f84\u4fe1\u606f\u914d\u7f6e\u597d\u73af\u5883\u53d8\u91cf\uff08\u901a\u5e38\u4e3a <code>CUDA_HOME</code> \uff09\u5373\u53ef\u3002</p> <p><code>/home/share</code> \u76ee\u5f55\u4e0b\u6709\u4e00\u4e9b\u5df2\u4e0b\u8f7d\u7684 <code>whl</code> \u6587\u4ef6\uff0c\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7 <code>pip install</code> \u5b89\u88c5\u81f3\u865a\u62df\u73af\u5883\u7684\u5b89\u88c5\u5305\u3002\u5982\u679c\u6ee1\u8db3\u9700\u6c42\u53ef\u4ee5\u76f4\u63a5\u5b89\u88c5\u81f3\u81ea\u5df1\u7684\u73af\u5883\u4f7f\u7528\u3002</p>"},{"location":"basis/#33","title":"3.3 \u8c03\u8bd5\u673a\u4e0d\u4fdd\u8bc1\u7a0b\u5e8f\u4e0d\u88ab\u4e2d\u65ad","text":"<p>\u8c03\u8bd5\u673a\u4ec5\u4f9b\u4ee3\u7801\u8fd0\u884c\u524d\u8c03\u8bd5\uff0c\u6b63\u5f0f\u8fd0\u884c\u4efb\u52a1\u8bf7\u63d0\u4ea4 Slurm \u7cfb\u7edf\u6267\u884c\u3002</p> <p>\u4e3a\u4fdd\u8bc1\u8c03\u8bd5\u673a\u53ef\u7528\uff0c\u8c03\u8bd5\u673a\u4e0a\u7684\u7a0b\u5e8f\u51fa\u73b0\u5f02\u5e38\u65f6\uff08\u5f02\u5e38\u9ad8\u7684 CPU \u3001\u5185\u5b58\u3001 IO \u5360\u7528\uff09\uff0c\u7ba1\u7406\u5458\u5c06\u5728\u4e0d\u901a\u77e5\u7528\u6237\u7684\u60c5\u51b5\u4e0b\u7ec8\u6b62\u8be5\u8fdb\u7a0b\u3002\u53e6\u5916\uff0c\u5f53\u53ef\u7528\u5185\u5b58\u4f4e\u4e8e 10% \u65f6\uff0c\u5185\u5b58\u5360\u7528\u6700\u591a\u7684\u8fdb\u7a0b\u5c06\u88ab\u7cfb\u7edf\u81ea\u52a8\u6740\u6b7b\u3002</p>"},{"location":"conda/","title":"\u4f7f\u7528 Conda","text":"<p>Conda \u662f\u4e00\u4e2a\u5f00\u6e90\u3001\u8de8\u5e73\u53f0\u3001\u8bed\u8a00\u65e0\u5173\u7684\u5305\u7ba1\u7406\u4e0e\u73af\u5883\u7ba1\u7406\u7cfb\u7edf\u3002\u672c\u7bc7\u4ecb\u7ecd\u5728\u96c6\u7fa4\u4e2d\u4f7f\u7528 conda \u7684\u65b9\u6cd5\u3002</p>"},{"location":"conda/#1","title":"1. \u6362\u6e90\u52a0\u901f","text":"<p>\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u4f7f\u7528\u56fd\u5185\u7684\u955c\u50cf\u6e90\u52a0\u5feb\u5305\u5b89\u88c5\u901f\u5ea6\uff1a</p> <pre><code>echo \"channels: \n  - defaults\nshow_channel_urls: true\ndefault_channels:\n  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main\n  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/r\n  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/msys2\ncustom_channels:\n  conda-forge: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud\n  msys2: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud\n  bioconda: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud\n  menpo: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud\n  pytorch: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud\n  simpleitk: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud\" &gt; ~/.condarc\n</code></pre>"},{"location":"conda/#2","title":"2. \u521b\u5efa\u73af\u5883","text":"<pre><code>conda create [env_name]\n</code></pre>"},{"location":"conda/#3","title":"3. \u6fc0\u6d3b\u73af\u5883","text":"<p>\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u6fc0\u6d3b\u65b0\u7684\u73af\u5883\uff1a</p> <pre><code>conda activate [env_name]\n</code></pre> <p>\u5728\u96c6\u7fa4\u4e0a\u4f7f\u7528 srun, sbatch \u7b49\u547d\u4ee4\u63d0\u4ea4\u4efb\u52a1\u524d\uff0c\u9700\u8981\u5148\u901a\u8fc7\u4e0a\u8ff0\u547d\u4ee4\u8fdb\u5165\u7279\u5b9a\u73af\u5883\u3002</p>"},{"location":"conda/#4-bash","title":"4. \u975e Bash \u73af\u5883","text":"<p>\u5982\u679c\u9700\u8981\u5728\u5176\u4ed6 shell ( zsh \u7b49) \u4e2d\u4f7f\u7528 conda \uff0c\u4f7f\u7528\u4e0b\u9762\u7b49\u547d\u4ee4\u8fdb\u884c\u521d\u59cb\u5316\uff1a</p> <pre><code>/usr/local/miniconda3/bin/conda init\n</code></pre> <p>\u7136\u540e\u91cd\u65b0\u8fdb\u5165 shell \uff0c\u5373\u53ef\u6b63\u5e38\u4f7f\u7528 conda \u3002</p>"},{"location":"docker/","title":"\u4f7f\u7528 Docker","text":""},{"location":"docker/#_1","title":"\u7b80\u4ecb","text":"<p>Docker \u5728 AIR \u670d\u52a1\u5668\u4e0a\u7684\u5e38\u89c1\u4f5c\u7528\uff1a</p> <ul> <li>\u65e0\u9700\u4e3b\u673a\u4e0a\u7684 <code>sudo</code> \u6743\u9650\u6267\u884c\u547d\u4ee4\uff1b</li> <li>\u4f7f\u7528\u4ed6\u4eba\u6253\u5305\u597d\u7684\u5b9e\u9a8c\u73af\u5883\u8fdb\u884c\u5b9e\u9a8c\uff0c\u514d\u53bb\u914d\u73af\u5883\u7684\u9ebb\u70e6\uff0c\u4ee5\u53ca\u4fee\u6539 CUDA \u7248\u672c\u7b49\u5728\u4e3b\u673a\u4e0a\u4f1a\u5f71\u54cd\u4ed6\u4eba\u7684\u64cd\u4f5c\u3002</li> </ul> <p>\u533a\u5206 image \u548c container</p> <p>\u521d\u5b66\u8005\u5e38\u5e38\u6df7\u6dc6 Docker \u4e2d\u7684 image \u548c container \u4e24\u4e2a\u6982\u5ff5\u3002</p> <ul> <li>image \uff08\u955c\u50cf\uff09\u662f <code>docker pull</code> \u4e0b\u6765\u7684\uff0c\u53ef\u4ee5\u901a\u8fc7 <code>docker images</code> \u67e5\u770b\u7cfb\u7edf\u4e0a\u6240\u6709\u7684 docker image \u3002</li> <li>container \uff08\u5bb9\u5668\uff09\u662f\u6267\u884c <code>docker run</code> \u4e4b\u540e\u4ea7\u751f\u7684\u3002\u53ef\u4ee5\u901a\u8fc7 <code>docker ps -a</code> \u67e5\u770b\u7cfb\u7edf\u4e0a\u6240\u6709 container \u7684\u8fd0\u884c\u60c5\u51b5\u3002</li> <li>image \u76f8\u5f53\u4e8e\u7cfb\u7edf\u5b89\u88c5\u5149\u76d8\uff0c container \u76f8\u5f53\u4e8e\u7528 image \u5b89\u88c5\u4e4b\u540e\u8fd0\u884c\u8d77\u6765\u7684\u4e3b\u673a\u3002\u6240\u4ee5\u5728 container \u505a\u4fee\u6539\u5e76\u4e0d\u4f1a\u4fee\u6539 image \u3002\u540c\u6837\u7684 image \uff0c\u65e0\u8bba\u4ece\u5b83\u8dd1\u8d77\u6765\u7684 container \u600e\u4e48\u6539\uff0c\u6bcf\u6b21\u6267\u884c <code>docker run</code> \u4e4b\u540e\u751f\u6210\u7684\u65b0\u5bb9\u5668\u5185\u90e8\u6587\u4ef6\u90fd\u662f\u4e00\u6837\u7684\u3002</li> </ul>"},{"location":"docker/#image-container","title":"\u8bf7\u53ca\u65f6\u6e05\u7406\u4e0d\u7528\u7684 image \u548c container","text":"<p>\u524d\u9762\u63d0\u5230\uff1a</p> <ul> <li>\u7528 <code>docker images</code> \u67e5\u770b\u6240\u6709\u7684\u955c\u50cf\u3002</li> <li>\u7528 <code>docker ps -a</code> \u67e5\u770b\u6240\u6709\u7684\u5bb9\u5668\u3002</li> </ul> <p>\u4e3a\u8282\u7ea6\u78c1\u76d8\u7a7a\u95f4\uff0c</p> <ul> <li>\u5bf9\u4e8e\u4e0d\u7528\u7684\u955c\u50cf\uff0c\u8bf7\u53ca\u65f6\u7528 <code>docker rmi &lt;image_id&gt;</code> \u5220\u9664\u3002</li> <li>\u5bf9\u4e8e\u4e0d\u7528\u7684\u5bb9\u5668\uff0c\u8bf7\u53ca\u65f6\u7528 <code>docker stop &lt;container_id&gt;</code> \u548c  <code>docker rm &lt;container_id&gt;</code> \u505c\u6b62\u5e76\u5220\u9664\u3002</li> </ul>"},{"location":"docker/#imagecontainer","title":"\u5982\u4f55\u4fdd\u5b58 image/container","text":"<p>\u524d\u9762\u63d0\u5230\uff0c\u4fee\u6539 container \u5e76\u4e0d\u4f1a\u4fee\u6539 image \u3002\u4f46\u662f\u53ef\u4ee5\u901a\u8fc7</p> <pre><code>docker commit &lt;container_id&gt; &lt;img_name&gt;:&lt;img_tag&gt;\n</code></pre> <p>\u5c06\u4e00\u4e2a container commit \u6210\u4e3a\u4e00\u4e2a\u88ab\u6807\u8bb0\u4e3a <code>img_name:img_tag</code> \u7684 image \u3002\u8fd9\u53ef\u4ee5\u7528\u4e8e\uff1a\u5728\u67d0\u4e2a image \u7684 container \u4e2d\u505a\u4e86\u4fee\u6539\uff0c\u4fdd\u5b58\u4fee\u6539\u4e4b\u540e\u72b6\u6001\u4e3a image \uff0c\u8fd9\u6837\u53ef\u4ee5\u4ece\u65b0 image \u542f\u52a8\uff0c\u4e0d\u5fc5\u4ece\u65e7 image \u542f\u52a8\u4e4b\u540e\u518d\u91cd\u590d\u81ea\u5df1\u7684\u4fee\u6539\u3002</p> <p>\u5728\u4e0d\u540c\u673a\u5668\u95f4\u4f20\u8f93 image \uff0c\u9664\u4e86\u5c06 image \u53d1\u5e03\u5230\u7c7b\u4f3c\u4e8e Docker Hub \u7684\u4ed3\u5e93\u7136\u540e\u5728\u5176\u5b83\u673a\u5668\u4e0a\u62c9\u53d6\uff0c\u8fd8\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u4ee5\u6587\u4ef6\u5f62\u5f0f\u4fdd\u5b58\u3001\u52a0\u8f7d image \u3002</p> <pre><code>docker save container_id &gt; container.tar\ndocker load &lt; container.tar\n</code></pre> <p>\u663e\u7136\uff0c\u7ed3\u5408\u4e0a\u8ff0\u7684 <code>commit</code>, <code>save</code>, <code>load</code> \u4e09\u8005\uff0c\u5c31\u53ef\u4ee5\u5b9e\u73b0 container \u7684\u4fdd\u5b58\u4e0e\u52a0\u8f7d\u3002</p> <p>\u9632\u6b62 Docker \u7684 layer \uff08\u5c42\uff09\u4fe1\u606f\u4e22\u5931\uff01</p> <p>docker \u5206\u5c42\u7684\u6587\u4ef6\u7cfb\u7edf\u4f7f\u5f97\u4e0d\u540c image \u53ef\u4ee5\u5171\u4eab\u5171\u6709\u7684\u5c42\u3002\u800c\u4e0a\u8ff0 <code>commit</code>, <code>save</code>, <code>load</code> \u64cd\u4f5c\u90fd\u80fd\u591f\u4fdd\u7559\u5c42\u4fe1\u606f\uff0c\u53ef\u4ee5\u5b9e\u73b0\u5c42\u5171\u4eab\u6216\u8005\u56de\u9000\u3002</p> <p>\u800c\u53e6\u4e00\u7ec4\u64cd\u4f5c <code>export</code>, <code>import</code> \u867d\u7136\u4e5f\u80fd\u5b9e\u73b0 image \u7684\u4fdd\u5b58\u548c\u52a0\u8f7d\uff0c\u4f46\u4f1a\u4e22\u5931\u5c42\u4fe1\u606f\uff01\u5148 <code>export</code> \u518d <code>import</code> \u4e4b\u540e\u7684 image \u53ea\u4f1a\u6709\uff08\u901a\u5e38\u5f88\u5927\u7684\uff09\u4e00\u5c42\uff01\u8fd9\u4f7f\u5f97\u4f60\u7684 image \u5982\u679c\u4f20\u5230 docker \u4ed3\u5e93\u4e0a\u518d\u88ab pull \u65f6\u65e0\u6cd5\u5171\u4eab\u673a\u5668\u4e0a\u73b0\u6709\u7684\u5c42\uff0c\u6bcf\u6b21\u66f4\u65b0\u65f6\u4e0d\u80fd\u4ec5\u4ec5\u66f4\u65b0\u6700\u540e\u505a\u4e86\u4fee\u6539\u7684\u5c42\uff0c\u800c\u662f\u8981\u66f4\u65b0\u6574\u4e2a image \uff0c\u5927\u5927\u589e\u52a0\u4e86\u7f51\u7edc\u4f20\u8f93\u91cf\u548c\u78c1\u76d8\u7a7a\u95f4\u5360\u7528\uff1b\u540c\u65f6\u4e5f\u65e0\u6cd5\u6839\u636e\u5386\u53f2\u5b9e\u73b0\u56de\u9000\u3002\u56e0\u6b64\u4e0d\u63a8\u8350\u8fd9\u79cd\u64cd\u4f5c\u3002</p>"},{"location":"enroot/","title":"\u5728\u96c6\u7fa4\u4e2d\u4f7f\u7528\u5bb9\u5668\u5e94\u7528","text":"<p>\u7531\u4e8e Docker \u5bb9\u5668\u5b58\u5728\u7684\u4e00\u4e9b\u4e0d\u8db3\uff0c\u56e0\u6b64\u6211\u4eec\u91c7\u7528 NVIDIA \u63d0\u4f9b\u7684\u5de5\u5177 enroot \u6765\u5728\u96c6\u7fa4\u4e0a\u8fd0\u884c Docker \u5e94\u7528\u3002\u5982\u679c\u9700\u8981\u4f7f\u7528\u5bb9\u5668\u5e94\u7528\uff0c\u8bf7\u53c2\u7167\u4e0b\u9762\u7684\u6b65\u9aa4\u8fdb\u884c\u64cd\u4f5c\u3002</p>"},{"location":"enroot/#1-docker-enroot","title":"1. \u5c06 Docker \u955c\u50cf\u8f6c\u6362\u4e3a enroot \u683c\u5f0f\u955c\u50cf","text":"<pre><code># From Docker hub\nenroot import docker://[USER@][REGISTRY#]IMAGE[:TAG]\n# Example: \n# docker pull pytorch/pytorch -&gt; enroot import docker://pytorch/pytorch\n# From Docker daemon\nenroot import dockerd://IMAGE[:TAG]\n# Examples\ndocker images\n# REPOSITORY        TAG     IMAGE ID                CREATED                 SIZE\n# openjdk               8     448f9e615795    11 days ago     526MB\n# -&gt; enroot import dockerd://openjdk:8\n</code></pre> <p>\u8fd0\u884c\u547d\u4ee4\u540e\uff0c\u4f1a\u5728\u5f53\u524d\u76ee\u5f55\u4e0b\u751f\u6210<code>.sqsh</code> \u683c\u5f0f\u7684\u672c\u5730\u955c\u50cf\u3002</p>"},{"location":"enroot/#2-srun","title":"2. \u901a\u8fc7 <code>srun</code> \u547d\u4ee4\u63d0\u4ea4\u5728\u5bb9\u5668\u4e2d\u8fd0\u884c\u7684\u547d\u4ee4","text":"<p>\u53ea\u80fd\u901a\u8fc7 <code>srun</code> \u547d\u4ee4\u63d0\u4ea4\u5728\u5bb9\u5668\u4e2d\u8fd0\u884c\u7684\u547d\u4ee4\uff08\u4e0d\u652f\u6301 <code>sbatch</code> \uff09\u3002</p> <p>\u9605\u8bfb\u4ee5\u4e0b\u90e8\u5206\u524d\u8bf7\u5148\u9605\u8bfb <code>srun</code> \u547d\u4ee4\u7684\u4f7f\u7528\u65b9\u6cd5\u3002\u5982\u679c\u9700\u8981\u5728\u5bb9\u5668\u4e2d\u8fd0\u884c\u547d\u4ee4\uff0c\u4ec5\u9700\u8981\u5728\u8c03\u7528 <code>srun</code> \u547d\u4ee4\u65f6\u989d\u5916\u6dfb\u52a0\u4e0b\u9762\u90e8\u5206\u53c2\u6570\u5373\u53ef\uff1a</p> <ul> <li><code>--container-image</code>: \u5bb9\u5668\u955c\u50cf\u3002\u53ef\u4ee5\u4e3a\u4e0a\u4e00\u6b65\u751f\u6210 <code>.sqsh</code> \u6587\u4ef6\u8def\u5f84\uff0c\u4e5f\u53ef\u4ee5\u662f\u955c\u50cf URL \u5982 <code>pytorch/pytorch</code>. \u63a8\u8350\u4f7f\u7528\u524d\u8005\u4f5c\u4e3a\u8f93\u5165\uff0c\u907f\u514d\u91cd\u590d <code>import</code> \u6d6a\u8d39\u65f6\u95f4</li> <li><code>--container-mounts=SRC:DST[:FLAGS][,SRC:DST...]</code>: \uff08\u53ef\u9009\uff09\u8def\u5f84\u6620\u5c04\u3002\u5c06\u5f53\u524d\u7cfb\u7edf\u4e2d <code>SRC</code> \u6620\u5c04\u81f3\u5bb9\u5668\u5185 <code>DST</code>\uff0c\u5982\u4e3a\u53ef\u8bfb\u5199\u6620\u5c04\uff0c\u9700\u5c06 <code>FLAGS</code> \u7f6e\u4e3a <code>rw</code></li> <li><code>--container-save=SAVE_PATH</code>: \uff08\u53ef\u9009\uff09\u5bb9\u5668\u4fdd\u5b58\u76ee\u5f55\u3002\u5982\u679c\u6307\u5b9a\u8fd9\u4e00\u53c2\u6570\uff0c\u8fd0\u884c\u7ed3\u675f\u540e\u5bb9\u5668\u4f1a\u4fdd\u5b58\u81ea\u8eab\u72b6\u6001\u81f3 <code>SAVE_PATH</code> \u4e0b\u7684 <code>.sqsh</code> \u683c\u5f0f\u6587\u4ef6</li> <li><code>--container-mount-home</code>: \uff08\u53ef\u9009\uff09\u6302\u8f7d <code>/home</code> \u76ee\u5f55</li> <li><code>--no-container-mount-home</code>: \uff08\u53ef\u9009\uff09\u4e0d\u6302\u8f7d <code>/home</code> \u76ee\u5f55</li> <li><code>--container-remap-root</code>:  \uff08\u53ef\u9009\uff09\u5728\u5bb9\u5668\u5185\u8eab\u4efd\u4e3a <code>root</code></li> <li> <p><code>--container-writable</code>: \uff08\u53ef\u9009\uff09\u5bb9\u5668\u5185\u6587\u4ef6\u7cfb\u7edf\u6302\u8f7d\u4e3a\u53ef\u8bfb\u5199</p> </li> <li> <p><code>--container-readonly</code>: \uff08\u53ef\u9009\uff09\u5bb9\u5668\u5185\u6587\u4ef6\u7cfb\u7edf\u6302\u8f7d\u4e3a\u53ea\u8bfb</p> </li> </ul>"},{"location":"faq/","title":"Faq","text":"<pre><code>export HTTP_PROXY=\"http://localhost:9000\"\nexport HTTPS_PROXY=\"http://localhost:9000\"\nexport http_proxy=\"http://localhost:9000\"\nexport https_proxy=\"http://localhost:9000\"\nexport ALL_PROXY=\"http://localhost:9000\"\nexport all_proxy=\"http://localhost:9000\"\n</code></pre>"},{"location":"gpu/","title":"\u901a\u8fc7 slurm \u7cfb\u7edf\u4f7f\u7528 GPU \u8d44\u6e90","text":"<p>Slurm \u7cfb\u7edf</p> <p>Slurm \u4efb\u52a1\u8c03\u5ea6\u5de5\u5177 \uff0c\u662f\u4e00\u4e2a\u7528\u4e8e Linux \u548c Unix \u5185\u6838\u7cfb\u7edf\u7684\u514d\u8d39\u3001\u5f00\u6e90\u7684\u4efb\u52a1\u8c03\u5ea6\u5de5\u5177\uff0c\u88ab\u4e16\u754c\u8303\u56f4\u5185\u7684\u8d85\u7ea7\u8ba1\u7b97\u673a\u548c\u8ba1\u7b97\u96c6\u7fa4\u5e7f\u6cdb\u91c7\u7528\u3002\u5b83\u63d0\u4f9b\u4e86\u4e09\u4e2a\u5173\u952e\u529f\u80fd\uff1a</p> <ol> <li>\u4e3a\u7528\u6237\u5206\u914d\u4e00\u5b9a\u65f6\u95f4\u7684\u4e13\u4eab\u6216\u975e\u4e13\u4eab\u7684\u8d44\u6e90 (\u8ba1\u7b97\u673a\u8282\u70b9)\uff0c\u4ee5\u4f9b\u7528\u6237\u6267\u884c\u5de5\u4f5c</li> <li>\u5b83\u63d0\u4f9b\u4e86\u4e00\u4e2a\u6846\u67b6\uff0c\u7528\u4e8e\u542f\u52a8\u3001\u6267\u884c\u3001\u76d1\u6d4b\u5728\u8282\u70b9\u4e0a\u8fd0\u884c\u7740\u7684\u4efb\u52a1 (\u901a\u5e38\u662f\u5e76\u884c\u7684\u4efb\u52a1\uff0c\u4f8b\u5982 MPI)</li> <li>\u4e3a\u4efb\u52a1\u961f\u5217\u5408\u7406\u5730\u5206\u914d\u8d44\u6e90</li> </ol>"},{"location":"gpu/#1-slurm","title":"1. Slurm \u7cfb\u7edf\u7684\u57fa\u672c\u6982\u5ff5","text":""},{"location":"gpu/#11","title":"1.1 \u7a0b\u5e8f\uff1a\u86cb\u7cd5\u914d\u65b9","text":"<p>Slurm \u7cfb\u7edf\u662f\u4e00\u4e2a\u4efb\u52a1\u8c03\u5ea6\u7cfb\u7edf\uff0c\u610f\u5473\u7740 Slurm \u7cfb\u7edf\u5b89\u6392\u7a0b\u5e8f\u8fd0\u884c\u7684\u4f4d\u7f6e\uff08\u670d\u52a1\u5668\uff09\uff0c\u534f\u8c03\u7a0b\u5e8f\u5360\u7528\u7684\u8d44\u6e90\uff0c\u4f46\u4e0d\u4f1a\u53c2\u4e0e\u7a0b\u5e8f\u7684\u5177\u4f53\u8fd0\u884c\u8fc7\u7a0b\u3002\u4efb\u4f55\u7a0b\u5e8f\u90fd\u53ef\u4ee5\u5728 Slurm \u7cfb\u7edf\u4e2d\u8fd0\u884c\uff01</p> <p>\u5c1d\u8bd5\u4f7f\u7528 Slurm \u7cfb\u7edf\u5427\uff01\u8fde\u63a5 VPN \uff0c\u767b\u9646 <code>10.0.0.251</code> \uff0c\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a</p> <pre><code>srun whoami\n</code></pre>"},{"location":"gpu/#12","title":"1.2 \u6570\u636e\uff1a\u86cb\u7cd5\u539f\u6599","text":"<p>Slurm \u7cfb\u7edf\u5185\u5305\u542b\u591a\u4e2a\u670d\u52a1\u5668\uff0c\u4f46\u662f\u6240\u6709\u670d\u52a1\u5668\u7684 <code>/home</code> \u76ee\u5f55\u90fd\u7531\u5b58\u50a8\u8282\u70b9\u63d0\u4f9b\uff0c\u662f\u4e00\u4e2a\u5171\u4eab\u7684\u5206\u533a\uff0c\u4e0d\u7528\u8003\u8651\u6570\u636e\u5728\u670d\u52a1\u5668\u4e4b\u95f4\u62f7\u8d1d\u540c\u6b65\u7684\u95ee\u9898\u3002</p> <p>\u5c1d\u8bd5\u4f7f\u7528\u5171\u4eab\u76ee\u5f55\uff1a</p> <pre><code>echo 'Hi!' &gt; ~/tmp\nhostname &amp;&amp; cat ~/tmp\nsrun hostname &amp;&amp; cat ~/tmp\n</code></pre>"},{"location":"gpu/#13-slurm","title":"1.3 Slurm \u8282\u70b9\uff1a\u86cb\u7cd5\u5de5\u5382","text":"<p>\u5728 Slurm \u7cfb\u7edf\u4e2d\uff0c\u8282\u70b9\u6307\u53ef\u4ee5\u72ec\u7acb\u8fd0\u884c\u7a0b\u5e8f\u7684\u670d\u52a1\u5668\uff0c\u6240\u6709\u670d\u52a1\u5668\u90fd\u53ef\u4ee5\u6267\u884c\u7528\u6237\u63d0\u4ea4\u7684\u7a0b\u5e8f\u3002\u76ee\u524d slurm \u7cfb\u7edf\u5185\u5171\u6709 5 \u4e2a\u8282\u70b9\uff1a</p> <ul> <li> <p>\u767b\u5f55\u8282\u70b9 <code>air-server</code> \uff1a\u8fde\u63a5 VPN \u540e ssh \u767b\u9646 <code>10.0.0.251</code> </p> </li> <li> <p>\u8df3\u677f\u8282\u70b9\u4e0a\u914d\u5907 2 \u5f20 A100 GPU \u4f9b\u8c03\u8bd5\uff0c\u8be5 GPU \u4f7f\u7528\u65e0\u9700\u901a\u8fc7 slurm \u7cfb\u7edf\u3002</p> </li> <li> <p>\u8fd0\u7b97\u8282\u70b9\uff1a\u5171\u6709 4 \u4e2a\uff0c\u5206\u522b\u662f</p> </li> <li> <p><code>air-node-02</code>\uff08\u914d\u5907 8 \u5f20 A100 GPU\uff09</p> </li> <li><code>air-node-03</code>\uff08\u914d\u5907 6 \u5f20 A100 GPU\uff09</li> <li><code>air-node-04</code>\uff08\u914d\u5907 6 \u5f20 A100 GPU\uff09</li> <li><code>air-node-05</code>\uff08\u914d\u5907 8 \u5f20 A100 GPU\uff09</li> </ul> <p>\u4f7f\u7528\u8fd0\u7b97\u7ed3\u70b9\u4e0a\u7684 GPU \u8d44\u6e90\uff0c\u9700\u8981\u901a\u8fc7 slurm \u7cfb\u7edf\u63d0\u4ea4\u4efb\u52a1</p>"},{"location":"gpu/#14","title":"1.4 \u4efb\u52a1\uff1a\u88c5\u8f7d\u914d\u65b9\u7684\u4fe1\u5c01","text":"<p>\u4efb\u52a1\u662f\u5bf9\u7a0b\u5e8f\u4ee5\u53ca\u7a0b\u5e8f\u8fd0\u884c\u5360\u7528\u8d44\u6e90\u7684\u5c01\u88c5\uff0c\u6bcf\u4e00\u4e2a\u4efb\u52a1\u6709\u7684\u5355\u72ec\u7684\u7f16\u53f7\uff08<code>JOBID</code>\uff09\u3002</p> <p>\u4efb\u52a1\u5728 slurm \u4e2d\u7684\u751f\u547d\u5468\u671f\u5982\u4e0b\uff1a</p> <ol> <li>\u4efb\u52a1 \u88ab\u7528\u6237\u521b\u5efa\u5e76\u63d0\u4ea4\u81f3 slurm \u7cfb\u7edf</li> <li>\u4efb\u52a1 \u88ab\u8ba1\u7b97\u4f18\u5148\u7ea7\uff0c\u8fdb\u5165\u7b49\u5f85\u961f\u5217\u76f8\u5e94\u4f4d\u7f6e</li> <li>\u4efb\u52a1 \u88ab\u79fb\u9664\u7b49\u5f85\u961f\u5217\u5e76\u5206\u914d\u8d44\u6e90\uff0c\u5f53 \u6ee1\u8db3\u8c03\u5ea6\u6761\u4ef6\uff08\u53ef\u7528\u8d44\u6e90\u5145\u8db3\uff0c\u4f7f\u7528\u603b\u91cf\u9650\u5236\u672a\u8fbe\u5230\uff0c\u8d44\u6e90\u548c\u65f6\u95f4\u4e0a\u9650\u5728\u9650\u5236\u8303\u56f4\u5185\uff09\u65f6</li> <li>\u4efb\u52a1 \u5728\u88ab\u5206\u914d\u7684\u8ba1\u7b97\u8282\u70b9\u5f00\u59cb\u6267\u884c</li> <li>\u4efb\u52a1 \u7ed3\u675f\uff0c\u5173\u952e\u4fe1\u606f\u8ba1\u5165\u5ba1\u8ba1\u7cfb\u7edf\u540e\u88ab\u9500\u6bc1</li> </ol>"},{"location":"gpu/#15-slurm","title":"1.5 Slurm \u7cfb\u7edf\uff1a\u914d\u65b9\u4fe1\u4ef6\u4e2d\u8f6c\u7ad9","text":"<p>\u6700\u540e\uff0cSlurm\u5e72\u7684\u4e8b\u60c5\u5c31\u662f\u628a\u4efb\u52a1\uff08\u4fe1\uff09\u5206\u53d1\u5230 Slurm \u8282\u70b9\uff08\u5de5\u5382\uff09\uff0cSlurm \u8282\u70b9\u6267\u884c\u4efb\u52a1\u6307\u5b9a\u7684\u7a0b\u5e8f\uff08\u5de5\u5382\u62c6\u5f00\u4fe1\u5c01\u5f00\u59cb\u751f\u4ea7\uff09\u3002</p> <p>\u4e0b\u9762\u4ecb\u7ecd\u4f7f\u7528 Slurm \u7cfb\u7edf\u7684\u5177\u4f53\u4f7f\u7528\u65b9\u6cd5\u3002</p>"},{"location":"gpu/#2-slurm","title":"2. Slurm \u7cfb\u7edf\u7684\u57fa\u672c\u4f7f\u7528\u65b9\u6cd5","text":"<p>\u5148\u8fdb\u5165 conda \u73af\u5883</p> <p>\u8981\u4f7f\u7528 conda \u865a\u62df\u73af\u5883\uff0c\u9700\u8981\u5728\u6267\u884c slurm \u76f8\u5173\u547d\u4ee4\u524d\u6267\u884c <code>conda activate xxx</code></p> <p>\u6211\u8981\u8dd1 3 \u5929 12 \u5c0f\u65f6\u5185\u8dd1\u5b8c\u7684\u7a0b\u5e8f\uff0c\u4f7f\u7528 2 \u5f20 GPU\uff0c\u4efb\u52a1\u540d\u5b57\u53eb <code>hard working</code></p> <pre><code>conda activate env\nsrun --gres=gpu:a100:2 --time 3-12:00:00 --job-name \"hard working\" sleep 10000 # \u771f\u6b63\u7528\u7684\u65f6\u5019\u8fd8\u662f\u4e0d\u8981\u8dd1 sleep \u4e86\n</code></pre> <p>\u6211\u8981\u8dd1 3 \u5929 12 \u5c0f\u65f6\u5185\u8dd1\u5b8c\u7684\u7a0b\u5e8f\uff0c\u4f7f\u7528 2 \u5f20 GPU\uff0c\u5f53\u4efb\u52a1\u5f00\u59cb\u6267\u884c\u3001\u7ed3\u675f\u65f6\u53d1\u90ae\u4ef6\u901a\u77e5\u6211</p> <pre><code>conda activate env\nsrun --gres=gpu:a100:2 --time 3-12:00:00 --mail-user abc@ef.gh --mail-type BEGIN,END\n</code></pre> <p>\u6211\u8981\u8dd1 3 \u5929 12 \u5c0f\u65f6\u5185\u8dd1\u5b8c\u7684\u7a0b\u5e8f\uff0c\u4f7f\u7528 2 \u5f20 GPU\uff0c\u8fd8\u8981\u4f7f\u7528 100GB \u5185\u5b58</p> <pre><code>conda activate env\nsrun --gres=gpu:a100:2 --time 3-12:00:00 --mem 100000 python ...\n</code></pre> <p>\u6211\u8981\u8dd1 3 \u5929 12 \u5c0f\u65f6\u5185\u8dd1\u5b8c\u7684\u7a0b\u5e8f\uff0c\u4f7f\u7528 2 \u5f20 GPU\uff0c\u8fd8\u8981\u4f7f\u7528 80 \u4e2a\u6838</p> <pre><code>conda activate env\nsrun --gres=gpu:a100:2 --time 3-12:00:00 --mem 100000 --cpus-per-task 80 python ...\n</code></pre> <p>\u6211\u8981\u4f7f\u7528 2 \u5f20 GPU\uff0c\u901a\u8fc7\u4ea4\u4e92\u65b9\u5f0f\u8fd0\u884c python\uff0c3 \u5c0f\u65f6\uff08180\u5206\u949f\uff09\u5c31\u884c</p> <pre><code>conda activate env\nsrun --gres=gpu:a100:2 --time 180 --pty python\n</code></pre> <p>\u6211\u8fd8\u6ca1\u60f3\u597d\u8981\u8dd1\u4ec0\u4e48\u7a0b\u5e8f\uff0c\u4f46\u662f\u6211\u5f97\u9700\u8981 1 \u5f20 GPU\uff0c3 \u5929\u5185\u80fd\u8dd1\u5b8c</p> <pre><code>conda activate env\nsalloc --time=3-0 --gres=gpu:a100:1\n# \u8fdb\u5165\u65b0\u7684 shell\uff0c\u8fd9\u4e2a\u65f6\u5019\u5206\u914d\u7684 3 \u5929\u65f6\u95f4\u5c31\u5f00\u59cb\u8ba1\u65f6\u4e86\n# \u5f53\u4f60\u60f3\u597d\u540e\nsrun python ...\n# \u8fd8\u662f\u6ca1\u60f3\u597d\uff0c\u5148\u7528\u4ea4\u4e92\u6a21\u5f0f\u8bd5\u8bd5\u624b\nsrun --pty python\n\n# \u4efb\u52a1\u90fd\u8dd1\u5b8c\u4e86\uff0c\u65e9\u70b9\u7ed3\u675f\u5427\nexit\n# Ctrl+d \u4e5f\u884c\n</code></pre> <p>\u6211\u60f3\u7528\u4e00\u5f20 GPU \u540c\u65f6\u8dd1\u4e24\u4e2a\u7a0b\u5e8f</p> <pre><code>conda activate env\nsrun --time=3-0 --gres=gpu:a100:1 --pty bash\n# \u8fdb\u5165\u65b0\u7684 bash \u73af\u5883\uff0c\u8fd9\u4e2a\u65f6\u5019\u5206\u914d\u7684 3 \u5929\u65f6\u95f4\u5c31\u5f00\u59cb\u8ba1\u65f6\u4e86\n# \u6267\u884c\u7b2c\u4e00\u4e2a\u7a0b\u5e8f\uff0c\u7a0b\u5e8f\u8f93\u51fa\u5230 a.out \u6587\u4ef6\u4e2d\npython a.py 1&gt;a.out 2&gt;&amp;1 &amp;\n# \u6267\u884c\u7b2c\u4e8c\u4e2a\u7a0b\u5e8f\uff0c\u7a0b\u5e8f\u8f93\u51fa\u5230 b.out \u6587\u4ef6\u4e2d\npython b.py 1&gt;b.out 2&gt;&amp;1 &amp;\n# \u5f53\u7136\u7528 tmux / screen \u4e5f\u53ef\u4ee5\uff0c\u4e0d\u8fc7\u6ce8\u610f srun \u672c\u8eab\u5728 tmux \u4e2d\u65f6\u5c31\u4e0d\u8981\u518d\u7528 tmux \u4e86\n# \u4efb\u52a1\u90fd\u8dd1\u5b8c\u4e86\uff0c\u65e9\u70b9\u7ed3\u675f\u5427\nexit\n# Ctrl+d \u4e5f\u884c\n</code></pre> <p>\u6211\u60f3\u4e00\u6b21\u63d0\u4ea4100\u4e2a\u4efb\u52a1\u6392\u7740\u961f\uff0c\u6709\u7a7a\u5c31\u6162\u6162\u8dd1\uff1b\u7b2c i \u4e2a\u4efb\u52a1\u5c31\u8dd1 <code>python run.py i</code></p> <p>\u521b\u5efa\u6587\u4ef6 <code>batch.sh</code> \uff08\u6587\u4ef6\u540d\u53ef\u6539\uff09</p> <pre><code>#!/bin/bash\n#SBATCH --job-name example                  # \u4efb\u52a1\u540d\u53eb example\n#SBATCH --array 0-99                        # \u63d0\u4ea4 100 \u4e2a\u5b50\u4efb\u52a1\uff0c\u5e8f\u53f7\u5206\u522b\u4e3a 0,1,2,...99\n#SBATCH --gres gpu:a100:1                   # \u6bcf\u4e2a\u5b50\u4efb\u52a1\u90fd\u7528\u4e00\u5f20 A100 GPU\n#SBATCH --time 1-1:00:00                    # \u5b50\u4efb\u52a1 1 \u5929 1 \u5c0f\u65f6\u5c31\u80fd\u8dd1\u5b8c\n#SBATCH --output %A_%a.out                  # 100\u4e2a\u7a0b\u5e8f\u8f93\u51fa\u91cd\u5b9a\u5411\u5230 [\u4efb\u52a1id]_[\u5b50\u4efb\u52a1\u5e8f\u53f7].out\n#SBATCH --mail-user example@gmail.com       # \u8fd9\u4e9b\u7a0b\u5e8f\u5f00\u59cb\u3001\u7ed3\u675f\u3001\u5f02\u5e38\u7a81\u51fa\u7684\u65f6\u5019\u90fd\u53d1\u90ae\u4ef6\u544a\u8bc9\u6211\n#SBATCH --mail-type ALL                     \n# \u4efb\u52a1 ID \u901a\u8fc7 SLURM_ARRAY_TASK_ID \u73af\u5883\u53d8\u91cf\u8bbf\u95ee\n# \u4e0a\u8ff0\u884c\u6307\u5b9a\u53c2\u6570\u5c06\u4f20\u9012\u7ed9 sbatch \u4f5c\u4e3a\u547d\u4ee4\u884c\u53c2\u6570\n# \u4e2d\u95f4\u4e0d\u53ef\u4ee5\u6709\u975e #SBATCH \u5f00\u5934\u7684\u884c\n# \u6267\u884c sbatch \u547d\u4ee4\u524d\u5148\u901a\u8fc7 conda activate [env_name] \u8fdb\u5165\u73af\u5883\npython run.py ${SLURM_ARRAY_TASK_ID}\n</code></pre> <p>\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4</p> <pre><code>conda activate env\nsbatch batch.sh\n</code></pre>"},{"location":"gpu/#3","title":"3. \u4efb\u52a1\u4f18\u5148\u7ea7\u4e0e\u8c03\u5ea6\u7b56\u7565","text":"<p>\u8fdb\u5165\u961f\u5217\u7684\u4efb\u52a1\u6309\u7167\u4ee5\u4e0b\u516c\u5f0f\u8ba1\u7b97\u4f18\u5148\u7ea7\uff0c\u4f18\u5148\u7ea7\u6570\u503c\u8d8a\u9ad8\uff0c\u4efb\u52a1\u5728\u961f\u5217\u4e2d\u6392\u961f\u8d8a\u9760\u524d\uff1a</p> <pre><code>P = 3 * p_age + 1 * p_fair + 10 * p_qos\n</code></pre> <p>\u5176\u4e2d\uff0c <code>p_age</code> \uff0c <code>p_fair</code> \uff0c <code>p_qos</code> \u5747\u4e3a 0 \u5230 1 \u8303\u56f4\u5185\u6d6e\u70b9\u6570\u3002\u5404\u56e0\u5b50\u8ba1\u7b97\u65b9\u6cd5\u5982\u4e0b\uff1a</p> <ul> <li> <p><code>p_age</code> \uff1a\u65f6\u95f4\u56e0\u5b50\uff0c\u7531\u4efb\u52a1\u63d0\u4ea4\u5f00\u59cb\u4ece 0.0 \u968f\u65f6\u95f4\u5747\u5300\u589e\u957f\uff0c3 \u5929\u540e\u589e\u957f\u81f3 1.0 \u968f\u540e\u4fdd\u6301\u4e0d\u53d8</p> </li> <li> <p><code>p_fair</code> \uff1a\u516c\u5e73\u56e0\u5b50\uff0c\u7531 Slurm \u8ba1\u7b97\u5f97\u5230\uff0c\u53ef\u901a\u8fc7 <code>sshare</code> \u547d\u4ee4\u67e5\u770b\u3002Slurm \u7cfb\u7edf\u4fdd\u8bc1</p> </li> <li> <p>\u96c6\u7fa4\u8d44\u6e90\u4f7f\u7528\u91cf\u591a\u7684\u7ec4\uff0c\u5176\u7ec4\u5185\u7528\u6237\u7684\u516c\u5e73\u56e0\u5b50\u4e00\u5b9a\u4e25\u683c\u5c0f\u4e8e\u5176\u5b83\u7ec4\u7684\u7528\u6237</p> </li> <li> <p>\u7ec4\u5185\u7528\u6237\u5177\u6709\u76f8\u540c\u7684\u516c\u5e73\u56e0\u5b50</p> </li> <li> <p><code>p_qos</code> \uff1a\u4f18\u5148\u7ea7\u56e0\u5b50\u3002\u73b0\u5728\uff0c\u96c6\u7fa4\u4e0a\u63d0\u4ea4\u7684\u4efb\u52a1\u5177\u6709 <code>qos</code> \u5c5e\u6027\uff0c\u53ef\u901a\u8fc7 <code>--qos</code> \u53c2\u6570\u624b\u52a8\u6307\u5b9a\uff0c\u53ef\u9009\u503c\u4e3a <code>high</code> \u4e0e <code>normal</code> \uff1b <code>high</code> \u7ea7\u522b\u4efb\u52a1\u7684\u4f18\u5148\u7ea7\u56e0\u5b50\u4e3a 1.0 \uff0c<code>normal</code> \u7ea7\u522b\u4efb\u52a1\u7684\u4f18\u5148\u7ea7\u56e0\u5b50\u4e3a 0.0</p> </li> </ul> <p>\u6bcf\u4e2a\u7528\u6237\u6700\u591a\u53ea\u80fd\u6709 1 \u4e2a\u9ad8\u4f18\u5148\u7ea7\u4efb\u52a1\u6b63\u5728\u8fd0\u884c\uff1b\u6bcf\u4e2a\u7ec4\u6700\u591a\u53ea\u80fd\u6709 4 \u4e2a\u9ad8\u4f18\u5148\u7ea7\u4efb\u52a1\u5728\u961f\u5217\u4e2d</p>"},{"location":"gpu/#4","title":"4. \u4efb\u52a1\u9650\u5236","text":"<p>\u4ece 2022 \u5e74 2 \u6708 1 \u65e5\u8d77\uff0c\u96c6\u7fa4\u542f\u7528\u65b0\u7684\u4f7f\u7528\u9650\u5236\uff1a</p>"},{"location":"gpu/#41","title":"4.1 \u7d2f\u8ba1\u8d44\u6e90\u4f7f\u7528\u65f6\u9650\u5236","text":"<p>\u5bf9\u6240\u6709\u5f53\u524d\u8fd0\u884c\u4efb\u52a1\u548c\u5386\u53f2\u8fd0\u884c\u4efb\u52a1\uff0cSlurm \u7cfb\u7edf\u7edf\u8ba1\u7533\u8bf7\u8d44\u6e90\u91cf\uff08CPU\u3001\u5185\u5b58\u3001GPU\uff09\u4e0e\u5df2\u4f7f\u7528\u65f6\u95f4\u7684\u4e58\u79ef\uff0c\u8be5\u4e58\u79ef\u7684\u603b\u548c\u79f0\u4e3a\u7d2f\u8ba1\u8d44\u6e90\u4f7f\u7528\u65f6\u3002\u8be5\u7edf\u8ba1\u91cf\u4ee5 3 \u5929\u4e3a\u5468\u671f\u51cf\u534a\u3002\u5f53\u7d2f\u8ba1\u8d44\u6e90\u4f7f\u7528\u65f6\u8d85\u8fc7\u4e0b\u5217\u9650\u5236\u65f6\uff0c\u5f53\u524d\u6240\u6709\u6b63\u5728\u8fd0\u884c\u7684\u4efb\u52a1\u5c06\u88ab\u6740\u6b7b\u5e76\u4e0d\u80fd\u63d0\u4ea4\u65b0\u4efb\u52a1\uff1a</p> <ul> <li>CPU\uff1a230400 \u4e2a * \u5206\u949f \uff08160 \u4e2a * 1 \u5929\uff09</li> <li>\u5185\u5b58\uff1a576000000 MB * \u5206\u949f\uff08400 GB * 1 \u5929\uff09</li> <li>A100 GPU\uff1a34560 \u4e2a * \u5206\u949f\uff088 \u4e2a A100 GPU * 3 \u5929\uff09</li> </ul> <p>\u5386\u53f2\u4f7f\u7528\u91cf\u5df2\u6e05\u96f6</p> <p>\u6240\u6709\u7528\u6237\u7d2f\u8ba1\u8d44\u6e90\u4f7f\u7528\u65f6\u5df2\u7ecf\u5728 2022 \u5e74 2 \u6708 15 \u65e5\u6e05\u96f6\u3002</p> <p>\u4f8b\u5b50</p> <p>\u5bf9\u4e8e\u91cd\u5ea6 GPU \u7528\u6237\uff0c\u6700\u5927\u5316\u4f7f\u7528\u96c6\u7fa4\u7684\u65b9\u6cd5\u662f\u8fde\u7eed\u4f7f\u7528 4 \u5f20 A100 GPU</p>"},{"location":"gpu/#42","title":"4.2 \u5f53\u524d\u8d44\u6e90\u4f7f\u7528\u65f6\u9650\u5236","text":"<p>\u5bf9\u6240\u6709\u5f53\u524d\u8fd0\u884c\u4efb\u52a1\uff0cSlurm \u7cfb\u7edf\u7edf\u8ba1\u7533\u8bf7\u8d44\u6e90\u91cf\uff08CPU\u3001\u5185\u5b58\u3001GPU\uff09\u4e0e\u4efb\u52a1\u58f0\u660e\u4f7f\u7528\u65f6\u95f4\uff08<code>srun</code> \uff0c <code>salloc</code> \uff0c <code>sbatch</code> \u4e2d\u7684 <code>-t/--time</code> \u53c2\u6570\u6307\u5b9a\uff09\u7684\u4e58\u79ef\u3002\u5f53\u65b0\u63d0\u4ea4\u7684\u4efb\u52a1\u4f7f\u5f97\u8be5\u4e58\u79ef\u4e4b\u548c\u8d85\u8fc7\u4e0b\u5217\u9650\u5236\u65f6\uff0c\u8be5\u65b0\u4efb\u52a1\u5c06\u8fdb\u5165\u961f\u5217\u7b49\u5f85\uff0c\u76f4\u5230\u6b63\u5728\u5360\u7528\u8d44\u6e90\u7684\u4efb\u52a1\u7ed3\u675f\u8fd0\u884c\uff1a</p> <ul> <li>A100 GPU\uff1a11520 \u4e2a * \u5206\u949f\uff088 \u4e2a A100 GPU * 1 \u5929\uff09</li> </ul>"},{"location":"gpu/#43","title":"4.3 \u9ad8\u4f18\u5148\u7ea7\u4efb\u52a1\u9650\u5236","text":"<p>\u6bcf\u4e00\u4e2a\u7528\u6237\u6700\u591a\u6709 1 \u4e2a\u9ad8\u4f18\u5148\u7ea7\u4efb\u52a1\u6b63\u5728\u8fd0\u884c\u3002</p> <p>\u6bcf\u4e00\u4e2a\u7ec4\u6700\u591a\u63d0\u4ea4 4 \u4e2a\u9ad8\u4f18\u5148\u7ea7\u4efb\u52a1\u3002</p> <p>\u7ed5\u5f00\u9650\u5236</p> <p>\u5982\u679c\u6709\u7279\u6b8a\u9700\u6c42\u9700\u8981\u4e34\u65f6\u653e\u5bbd\u4ee5\u4e0a\u9650\u5236\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458</p>"},{"location":"gpu/#5-slurm","title":"5. Slurm \u7cfb\u7edf\u547d\u4ee4\u8be6\u89e3","text":""},{"location":"gpu/#51-srun","title":"5.1 srun: \u63d0\u4ea4\u4efb\u52a1\u5e76\u524d\u53f0\u8fd0\u884c","text":"<p><pre><code>srun --gres=gpu:a100:GPU_COUNT --time=d-hh:mm:ss [--mem=20000] CMD\n</code></pre> CMD \u4e3a\u7a0b\u5e8f\u6b63\u5e38\u6267\u884c\u65f6\u7684\u547d\u4ee4\u3002\u4f7f\u7528 <code>srun</code> \u547d\u4ee4\u63d0\u4ea4\u4efb\u52a1\u540e\uff0c\u7a0b\u5e8f\u8f93\u51fa\u5230 <code>stdout</code> \u4e0e <code>stderr</code> \uff0c\u5728\u63a7\u5236\u53f0\u4e2d\u53ef\u4ee5\u770b\u5230\u7a0b\u5e8f\u7684\u6240\u6709\u8f93\u51fa\u3002</p> <p>\u5982\u9700\u540e\u53f0\u8fd0\u884c\u4efb\u52a1\u8bf7\u4f7f\u7528 <code>tmux</code> / <code>screen</code> \u7b49\u5de5\u5177\u6216\u4f7f\u7528\u4e0b\u65b9 <code>sbatch</code> \u547d\u4ee4\u63d0\u4ea4\u4efb\u52a1\u3002</p> <p>\u53c2\u6570\u8bf4\u660e\uff1a</p> <ul> <li><code>--gres</code>: Generic RESources\uff0c\u7533\u8bf7\u4f7f\u7528\u7684 GPU \u7c7b\u578b\u4e0e\u6570\u91cf<ul> <li>\u76ee\u524d\u96c6\u7fa4\u4e2d\u53ea\u6709 NVIDIA A100 40GB \u4e00\u79cdGPU\uff0c\u7528 a100 \u6307\u4ee3</li> <li>\u53c2\u6570\u683c\u5f0f\uff1a<code>gpu:a100:GPU_COUNT</code></li> </ul> </li> <li><code>--time</code>: \u7a0b\u5e8f\u8fd0\u884c\u7684\u6700\u957f\u8fd0\u884c\u65f6\u95f4<ul> <li>\u9ed8\u8ba4\u503c\u4e3a1\u5206\u949f</li> <li>\u5982\u679c\u4efb\u52a1\u9700\u8981\u8fd0\u884c\u66f4\u957f\u65f6\u95f4\uff0c\u8bf7\u8054\u7cfb\u96c6\u7fa4\u7ba1\u7406\u5458</li> <li>\u8d85\u8fc7\u6700\u957f\u8fd0\u884c\u65f6\u95f4\u7684\u4efb\u52a1\u4f1a\u88ab\u5f3a\u884c\u7ec8\u6b62</li> <li>\u53c2\u6570\u683c\u5f0f\uff1a <code>d-hh:mm:ss</code></li> </ul> </li> <li> <p><code>--qos</code>: \uff08\u53ef\u9009\uff09\u4efb\u52a1\u7684\u4f18\u5148\u7ea7\u522b</p> <ul> <li>\u53ef\u9009\u7ea7\u522b\uff1a<code>high</code>\uff0c<code>normal</code></li> <li>\u9ed8\u8ba4\u503c\uff1a<code>normal</code></li> <li>\u6bcf\u4e2a\u7528\u6237\u6700\u591a\u53ea\u80fd\u6709 1 \u4e2a\u9ad8\u4f18\u5148\u7ea7\u4efb\u52a1\u6b63\u5728\u8fd0\u884c\uff1b\u6bcf\u4e2a\u7ec4\u6700\u591a\u53ea\u80fd\u6709 4 \u4e2a\u9ad8\u4f18\u5148\u7ea7\u4efb\u52a1\u5728\u961f\u5217\u4e2d</li> <li><code>high</code> \u7ea7\u522b\u4efb\u52a1\u5728\u961f\u5217\u4e2d\u7684\u4f18\u5148\u7ea7\u4e00\u5b9a\u6bd4 <code>normal</code> \u7ea7\u522b\u4efb\u52a1\u8981\u9ad8\uff0c\u4f1a\u88ab\u4f18\u5148\u8c03\u5ea6\u5f00\u59cb\u8fd0\u884c</li> </ul> </li> <li> <p><code>--nodelist</code>: \uff08\u53ef\u9009\uff09\u6307\u5b9a\u7a0b\u5e8f\u8fd0\u884c\u7684\u8282\u70b9\u673a\uff0c\u672a\u6307\u5b9a\u65f6\u5c06\u7531\u7cfb\u7edf\u81ea\u52a8\u5206\u914d\u3002\u76ee\u524d\u53ef\u9009\u7684\u8282\u70b9\u673a\u6709\uff1a</p> <ul> <li><code>air-node-02</code></li> <li><code>air-node-03</code></li> <li><code>air-node-04</code></li> <li><code>air-node-05</code></li> </ul> </li> <li><code>--cpus-per-task</code>: \uff08\u53ef\u9009\uff09\u4efb\u52a1\u8bf7\u6c42\u4f7f\u7528\u7684 CPU \u6838\u6570<ul> <li>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6bcf\u7533\u8bf7\u4e00\u5f20GPU\u4f1a\u914d\u7ed9 10 \u7684 CPU \u6838\u5fc3\uff1b\u56e0\u6b64\u9664\u975e\u7a0b\u5e8f\u9700\u8981\u4f7f\u7528\u5927\u91cf CPU \u6838\u5fc3\uff0c\u65e0\u9700\u6307\u5b9a\u6b64\u53c2\u6570</li> <li>\u53c2\u6570\u683c\u5f0f\uff1a\u6574\u6570</li> </ul> </li> <li><code>--mem</code>: \uff08\u53ef\u9009\uff09\u4efb\u52a1\u8bf7\u6c42\u4f7f\u7528\u7684\u5185\u5b58<ul> <li>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6bcf\u7533\u8bf7\u4e00\u5f20GPU\u4f1a\u914d\u7ed9 20GB \u7684\u5185\u5b58\uff1b\u56e0\u6b64\u9664\u975e\u7a0b\u5e8f\u9700\u8981\u4f7f\u7528\u5927\u91cf\u5185\u5b58\uff0c\u65e0\u9700\u6307\u5b9a\u6b64\u53c2\u6570</li> <li>\u53c2\u6570\u683c\u5f0f\uff1a\u6574\u6570\uff0c\u5355\u4f4d\u4e3a MB</li> </ul> </li> <li><code>--mail-user</code>: \uff08\u53ef\u9009\uff09\u4efb\u52a1\u72b6\u6001\u53d8\u66f4\u65f6\uff0c\u63a5\u6536\u66f4\u65b0\u90ae\u4ef6\u7684\u90ae\u7bb1</li> <li><code>--mail-type</code>: \uff08\u53ef\u9009\uff09\u5728\u4efb\u52a1\u72b6\u6001\u53d1\u751f\u54ea\u4e9b\u53d8\u5316\u65f6\uff0c\u53d1\u9001\u66f4\u65b0\u90ae\u4ef6<ul> <li><code>BEGIN</code>: \u4efb\u52a1\u4ece\u7b49\u5f85\u961f\u5217\u4e2d\u53d6\u51fa\uff0c\u5f00\u59cb\u8fd0\u884c\u65f6</li> <li><code>END</code>: \u4efb\u52a1\u6b63\u5e38\u7ed3\u675f\u65f6</li> <li><code>FAILURE</code>: \u4efb\u52a1\u5f02\u5e38\u9000\u51fa\u65f6</li> <li><code>ALL</code>: \u4ee5\u4e0a\u4e09\u79cd\u60c5\u51b5\u5747\u53d1\u9001\u72b6\u6001\u66f4\u65b0\u90ae\u4ef6</li> </ul> </li> </ul> <p>\u53c2\u6570\u4f4d\u7f6e</p> <p>\u63d0\u4f9b\u7ed9 <code>srun</code> \u547d\u4ee4\u7684\u53c2\u6570\u5e94\u5f53\u7f6e\u4e8e\u7a0b\u5e8f\u547d\u4ee4 CMD \u4e4b\u524d\uff0c\u5426\u5219\u4f1a\u88ab\u8ba4\u4e3a\u662f\u63d0\u4f9b\u7ed9 CMD \u7684\u8fd0\u884c\u53c2\u6570\u3002</p> <p>\u8fd0\u884c\u65f6\u95f4</p> <p>\u4e3a\u4e86\u5408\u7406\u4f7f\u7528GPU\u8d44\u6e90\uff0c\u8bf7\u63d0\u4ea4\u4efb\u52a1\u65f6\u6307\u5b9a\u4e00\u4e2a\u5408\u7406\u7684\u6700\u957f\u8fd0\u884c\u65f6\u95f4\u3002\u8bf7\u6ce8\u610f\uff0c\u8fc7\u957f\u7684\u8fd0\u884c\u65f6\u95f4\u53ef\u80fd\u5bfc\u81f4\u8c03\u5ea6\u7684\u4f18\u5148\u7ea7\u964d\u4f4e\uff0c\u8be6\u60c5\u8bf7\u89c1\u4e0b\u65b9\u8c03\u5ea6\u7b56\u7565\u8bf4\u660e\u3002</p> <p>\u5bb9\u5668\u5e94\u7528\u652f\u6301</p> <p>\u76ee\u524d\u96c6\u7fa4\u4e2d\u6240\u6709\u8282\u70b9\u5df2\u7ecf\u652f\u6301\u5bb9\u5668\u5e94\u7528\u3002 \u63d0\u4ea4\u8fd0\u884c\u5bb9\u5668\u7684\u4efb\u52a1\u9700\u8981\u5728\u4f7f\u7528 <code>srun</code> \u547d\u4ee4\u4f7f\u7528\u989d\u5916\u7684\u4e00\u4e9b\u53c2\u6570\uff0c\u5177\u4f53\u4f7f\u7528\u65b9\u6cd5\u8bf7\u53c2\u8003\u8fd9\u91cc\u3002 \u9700\u8981\u8fd0\u884c\u5bb9\u5668\u7684\u4efb\u52a1\u53ea\u80fd\u901a\u8fc7 <code>srun</code> \u63d0\u4ea4\uff08\u4e0d\u80fd\u901a\u8fc7 <code>sbatch</code>\uff09\u3002</p>"},{"location":"gpu/#52-squeue","title":"5.2 squeue: \u67e5\u770b\u4efb\u52a1\u961f\u5217","text":"<pre><code>squeue\n</code></pre> <p>\u663e\u793a\u6b63\u5728\u8fd0\u884c\u4e0e\u6b63\u5728\u6392\u961f\u7684\u4efb\u52a1\u3002\u6837\u4f8b\u8f93\u51fa\uff1a</p> <pre><code>JOBIDJOBID     USER    GROUP       NAME              STATE     QOS                 TIME        TIME_LIMIT  NODELIST    TRES_PER_NODPENDING_TIM s REASON              PRIORITY\n4437 4437      wenh    AIot        bash              PENDING   normal              0:00        5-00:00:00              gpu:a100:2       254244 s AssocGrpGRESRunMinut10800655\n4245 4245      chenxx  DISCOVER    bash              PENDING   normal              0:00        5-00:00:00              gpu:a100:8       529623 s BadConstraints      0\n4244 4244      liyang  DISCOVER    bash              PENDING   normal              0:00        5-00:00:00              gpu:a100:8       530287 s BadConstraints      0\n4504 4504      wangzy  JJ_Group    sd02w12adap30-hcl-RUNNING   normal              17:17:06    3-00:00:00  air-node-03 gpu:a100:2            1 s None                480769\n4484 4484      yuqy    JJ_Group    advcl-sd02w12adap3RUNNING   normal              20:17:26    3-00:00:00  air-node-03 gpu:a100:2            0 s None                480769\n4515 4515      tb5zhh  DISCOVER    interactive       RUNNING   normal              5:09:52     1-00:00:00  air-node-02 gpu:8                 1 s None                346153\n</code></pre> <p>\u8f93\u51fa\u8868\u683c\u5b57\u6bb5\u542b\u4e49\uff1a</p> <ul> <li><code>JOBID</code>: \u4efb\u52a1\u5e8f\u53f7</li> <li><code>USER</code>: \u4efb\u52a1\u63d0\u4ea4\u7528\u6237</li> <li><code>GROUP</code>: \u4efb\u52a1\u63d0\u4ea4\u7528\u6237\u6240\u5c5e\u5b9e\u9a8c\u5ba4\u540d\u79f0</li> <li><code>NAME</code>: \u4efb\u52a1\u540d\u79f0\u3002\u9ed8\u8ba4\u503c\u4e3a\u53ef\u6267\u884c\u6587\u4ef6\u540d (<code>bash</code>, <code>python</code> \u7b49)\uff0c\u4f7f\u7528 <code>sbatch</code> \u547d\u4ee4\u63d0\u4ea4\u4efb\u52a1\u53ef\u4ee5\u81ea\u5b9a\u4e49\u4efb\u52a1\u540d</li> <li><code>QOS</code>: TODO</li> <li><code>STATE</code>: \u4efb\u52a1\u72b6\u6001\uff0c\u5e38\u89c1\u4efb\u52a1\u72b6\u6001\u5982\u4e0b\uff1a<ul> <li><code>RUNNING</code>: \u4efb\u52a1\u6b63\u5728\u8fd0\u884c</li> <li><code>PENDING</code>: \u4efb\u52a1\u6b63\u5728\u961f\u5217\u4e2d\u7b49\u5f85\u5206\u914d\u8d44\u6e90</li> <li><code>COMPLETING</code>: \u4efb\u52a1\u6b63\u5728\u7ec8\u6b62</li> <li>\u51fa\u73b0\u5176\u4ed6\u72b6\u6001\u65f6\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458</li> </ul> </li> <li><code>TIME</code>: \u4efb\u52a1\u5df2\u8fd0\u884c\u65f6\u957f</li> <li><code>TIME_LIMIT</code>: \u4efb\u52a1\u6700\u957f\u8fd0\u884c\u65f6\u95f4\u3002\u8d85\u8fc7\u6700\u957f\u8fd0\u884c\u65f6\u95f4\u7684\u4efb\u52a1\u4f1a\u88ab\u5f3a\u884c\u7ec8\u6b62</li> <li><code>NODE_LIST</code>: \u4efb\u52a1\u4f7f\u7528\u7684\u8fd0\u7b97\u8282\u70b9</li> <li><code>TRES_PER_NODE</code>: \u4efb\u52a1\u7533\u8bf7\u4f7f\u7528\u7684\u8d44\u6e90\u6570\u91cf</li> <li><code>PENDING_TIME</code>: \u4efb\u52a1\u5728\u961f\u5217\u4e2d\u7b49\u5f85\u65f6\u957f\uff0c\u5355\u4f4d\u4e3a\u79d2</li> <li><code>REASON</code>: \u4efb\u52a1\u6392\u961f\u539f\u56e0</li> <li><code>PRIORITY</code>: TODO</li> </ul>"},{"location":"gpu/#53-scontrol","title":"5.3 scontrol: \u67e5\u770b\u6b63\u5728\u8fd0\u884c\u4efb\u52a1\u7684\u72b6\u6001","text":"<pre><code>scontrol show job JOBID\n</code></pre> <p>\u8be5\u547d\u4ee4\u8fd4\u56de\u4efb\u52a1\u7684\u8be6\u7ec6\u72b6\u6001\u3002\u5728\u8be5\u547d\u4ee4\u7684\u8f93\u51fa\u4e2d\uff0c\u80fd\u591f\u627e\u5230\u5173\u4e8e\u4efb\u52a1\u7684\u6240\u6709\u4fe1\u606f\uff1a\u63d0\u4ea4\u65f6\u95f4\u3001\u5f00\u59cb\u65f6\u95f4\u3001\u8fd0\u884c\u65f6\u957f\u3001\u7533\u8bf7\u8d44\u6e90\u3001\u6392\u961f\u65f6\u957f\u3001\u6392\u961f\u539f\u56e0\u7b49\u3002</p>"},{"location":"gpu/#54-sinfo","title":"5.4 sinfo: \u67e5\u770b\u96c6\u7fa4\u8fd0\u7b97\u8282\u70b9\u7684\u72b6\u6001","text":"<pre><code>sinfo\n</code></pre> <p>\u8be5\u547d\u4ee4\u8fd4\u56de\u96c6\u7fa4\u4e2d\u8fd0\u7b97\u8282\u70b9\u7684\u540d\u79f0\u3001\u8282\u70b9\u8d44\u6e90\u603b\u91cf\u3001\u8282\u70b9\u8d44\u6e90\u5df2\u4f7f\u7528\u91cf\u7b49\u4fe1\u606f\u3002\u6837\u4f8b\u8f93\u51fa\u5982\u4e0b\uff1a</p> <pre><code>NODELIST            STATE       AVAIL GRES                          CPUS(A/I/O/T)       GRES_USED                          MEMORY              ALLOCMEM            REASON              CPUS(A/I/O/T)\nair-node-02         mixed       up    gpu:a100:8                    80/80/0/160         gpu:a100:8(IDX:0-7)                320000              160000              none                80/80/0/160\nair-node-03         mixed       up    gpu:a100:6                    40/80/0/120         gpu:a100:4(IDX:0-1,3-4)            240000              80000               none                40/80/0/120\nair-node-04         idle        up    gpu:a100:6                    0/120/0/120         gpu:a100:0(IDX:N/A)                240000              0                   none                0/120/0/120\nair-node-05         idle        up    gpu:a100:8                    0/160/0/160         gpu:a100:0(IDX:N/A)                320000              0                   none                0/160/0/160\n</code></pre> <p>\u8f93\u51fa\u8868\u683c\u5b57\u6bb5\u542b\u4e49\uff1a</p> <ul> <li><code>NODELIST</code>: \u8282\u70b9\u540d\u79f0</li> <li><code>STATE</code>: \u8282\u70b9\u72b6\u6001<ul> <li><code>idle</code>: \u8282\u70b9\u7a7a\u95f2</li> <li><code>mixed</code>: \u8282\u70b9\u6b63\u5728\u8fd0\u884c\u4efb\u52a1\uff0c\u4f46\u662f\u4ecd\u6709\u53ef\u7528\u8d44\u6e90<ul> <li>\u8bf7\u6ce8\u610f\uff0c\u6b64\u5904\u6240\u6307\u8d44\u6e90\u5305\u62ecCPU\u3001\u5185\u5b58\u3001GPU\u7b49\uff0c\u6b64\u72b6\u6001\u4e0d\u4fdd\u8bc1\u6709\u7a7a\u95f2\u7684 GPU \u5361</li> </ul> </li> <li><code>alloc</code>: \u8282\u70b9\u6240\u6709\u8d44\u6e90\u5747\u88ab\u5360\u7528</li> <li><code>draining</code>, <code>drained</code>: \u65e0\u6cd5\u5728\u8be5\u8282\u70b9\u4e0a\u63d0\u4ea4\u65b0\u4efb\u52a1\uff0c\u4f46\u662f\u4f1a\u7b49\u5f85\u8282\u70b9\u4e0a\u73b0\u6709\u4efb\u52a1\u8fd0\u884c\u7ed3\u675f\u3002<ul> <li>\u51fa\u73b0\u6b64\u72b6\u6001\u539f\u56e0\u53ef\u7531 <code>REASON</code> \u5b57\u6bb5\u67e5\u770b\uff0c\u901a\u5e38\u4e3a\u8282\u70b9\u7ef4\u62a4\u6216\u8c03\u8bd5</li> <li>\u73b0\u6709\u4efb\u52a1\u7ed3\u675f\u524d\u4e3a <code>draining</code> \uff0c\u5168\u90e8\u73b0\u6709\u4efb\u52a1\u7ed3\u675f\u540e\u4e3a <code>drained</code></li> </ul> </li> <li><code>completing</code>: \u8282\u70b9\u4e0a\u6240\u6709\u4efb\u52a1\u5747\u5904\u4e8e<code>COMPLETING</code>\u72b6\u6001<ul> <li>\u6b64\u72b6\u6001\u662f\u6682\u65f6\u7684\uff0c\u5982\u679c\u957f\u65f6\u95f4\u4fdd\u6301\u6b64\u72b6\u6001\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458</li> </ul> </li> <li><code>fail</code>: \u8282\u70b9\u4e0d\u53ef\u7528<ul> <li>\u51fa\u73b0\u6b64\u72b6\u6001\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458</li> </ul> </li> </ul> </li> <li><code>AVAIL</code>: \u8282\u70b9\u72b6\u6001\uff08\u7b80\u7565\u7248\uff09<ul> <li><code>up</code>: \u53ef\u7528</li> <li><code>down</code>, <code>drain</code>: \u4e0d\u53ef\u7528</li> </ul> </li> <li><code>GRES</code>: \u8282\u70b9\u53ef\u7528 GPU \u8d44\u6e90</li> <li><code>GRES_USED</code>: \u8282\u70b9\u5df2\u5206\u914d GPU \u8d44\u6e90\u6570\u91cf\u53ca\u5e8f\u53f7</li> <li><code>MEMORY</code>: \u8282\u70b9\u53ef\u7528\u5185\u5b58\uff0c\u5355\u4f4d\u4e3aMB</li> <li><code>ALLOC_MEM</code>: \u8282\u70b9\u5df2\u5206\u914d\u5185\u5b58\uff0c\u5355\u4f4d\u4e3aMB</li> <li><code>REASON</code>: \u8282\u70b9\u5f02\u5e38\u72b6\u6001\u539f\u56e0</li> </ul>"},{"location":"gpu/#55-scancel","title":"5.5 scancel: \u53d6\u6d88\u4efb\u52a1","text":"<pre><code>scancel JOBID\n</code></pre> <p>\u53d6\u6d88\u4efb\u52a1\u3002\u53ea\u80fd\u53d6\u6d88\u81ea\u5df1\u63d0\u4ea4\u7684\u4efb\u52a1\u3002</p> <p><code>scancel</code> \u64cd\u4f5c\u5bf9\u8c61\u4e3a\u4efb\u52a1\u7ec4 ID \u65f6\uff0c\u4f1a\u53d6\u6d88\u4efb\u52a1\u7ec4\u4e2d\u6240\u6709\u4efb\u52a1\u3002\u8be6\u60c5\u8bf7\u89c1\u4e0b\u65b9 <code>sbatch</code> \u8bf4\u660e\u3002</p> <p>\u8be5\u64cd\u4f5c\u4e0d\u53ef\u9006\uff0c\u6267\u884c\u524d\u8bf7\u518d\u4e09\u786e\u8ba4\u3002</p>"},{"location":"gpu/#56-sbatch","title":"5.6 sbatch: \u6279\u91cf\u63d0\u4ea4\u540e\u53f0\u4efb\u52a1","text":"<pre><code>sbatch run.sh\n</code></pre> <p>\u6839\u636e <code>run.sh</code> \u5411 Slurm \u4e2d\u6279\u91cf\u63d0\u4ea4\u4efb\u52a1\uff0c\u6267\u884c\u540e\u7acb\u5373\u8fd4\u56de\u3002\u5982\u679c\u4efb\u52a1\u5728 <code>conda</code> \u73af\u5883\u4e2d\u6267\u884c\uff0c\u5728\u8fd0\u884c <code>sbatch</code> \u524d\u5e94\u5f53\u5148\u8fdb\u5165\u8be5 <code>conda</code> \u73af\u5883\u3002</p> <p><code>run.sh</code> \u7b2c\u4e00\u884c\u5fc5\u987b\u4e3a <code>#!/bin/bash</code>.</p> <p><code>sbatch</code> \u7684\u547d\u4ee4\u884c\u53c2\u6570\u53ef\u4ee5\u901a\u8fc7\u4e24\u79cd\u65b9\u5f0f\u6307\u5b9a\uff1a</p> <ol> <li>\u7f6e\u4e8e <code>sbatch</code> \u547d\u4ee4\u540e\uff0c\u5982 <code>sbatch --gres=gpu:a100:1 run.sh</code></li> <li>\u7f6e\u4e8e <code>run.sh</code> \u5f00\u5934\uff0c\u4ee5 shell \u6ce8\u91ca\u7684\u65b9\u5f0f\u63d0\u4f9b\uff0c\u5982 <code>#SBATCH --gres=gpu:a100:1</code> \uff1b\u6240\u6709 <code>#SBATCH</code> \u884c\u987b\u76f8\u90bb\u3002</li> </ol> <p>\u53c2\u6570\u8bf4\u660e\uff1a</p> <ul> <li><code>--job-name</code>: \u63d0\u4ea4\u7684\u4efb\u52a1\u540d\u79f0\u3002\u4f1a\u51fa\u73b0\u5728 <code>squeue</code> \u547d\u4ee4\u7684 <code>NAME</code> \u5b57\u6bb5\u5185\uff0c\u9ed8\u8ba4\u4e3a\u53ef\u6267\u884c\u6587\u4ef6\u540d\u3002</li> <li><code>--gres</code>: \u4efb\u52a1\u7533\u8bf7\u7684 GPU \u8d44\u6e90\uff0c\u683c\u5f0f\u540c <code>srun</code> \u4e2d <code>--gres</code></li> <li><code>--time</code>: \u4efb\u52a1\u6700\u957f\u8fd0\u884c\u65f6\u95f4\uff0c\u683c\u5f0f\u540c <code>srun</code> \u4e2d <code>--time</code></li> <li><code>--qos</code>: \uff08\u53ef\u9009\uff09\u4efb\u52a1\u7684\u4f18\u5148\u7ea7\u522b\uff0c\u683c\u5f0f\u540c <code>srun</code> \u4e2d <code>--qos</code></li> <li><code>--nodelist</code>: \uff08\u53ef\u9009\uff09\u6307\u5b9a\u4efb\u52a1\u8fd0\u884c\u7684\u8282\u70b9\u673a\uff0c\u683c\u5f0f\u540c <code>srun</code> \u4e2d <code>--nodelist</code></li> <li><code>--array</code>: \uff08\u53ef\u9009\uff09\u63d0\u4ea4\u6279\u91cf\u4efb\u52a1\uff08\u4efb\u52a1\u7ec4\uff09\u3002<ul> <li>\u4f7f\u7528\u6b64\u9009\u9879\u65f6\uff0c\u4f1a\u4e00\u6b21\u6027\u5c06\u591a\u4e2a\u4efb\u52a1\u63d0\u4ea4\u81f3 Slurm \u7cfb\u7edf\u3002</li> <li>\u6bcf\u4e00\u4e2a\u4efb\u52a1\u7ec4\u4e0e\u666e\u901a\u4efb\u52a1\u7684\u5730\u4f4d\u662f\u7b49\u540c\u7684\uff0c\u4efb\u52a1\u7ec4\u672c\u8eab\u6709\u4e00\u4e2a ID (<code>ARRAYID</code>)\uff0c\u8fd9\u4e2a ID \u53ef\u4ee5\u901a\u8fc7 <code>squeue</code> \u547d\u4ee4\u67e5\u770b\u3002\u5bf9\u8fd9\u4e2a ID \u4f7f\u7528 <code>scancel</code> \u4f1a\u53d6\u6d88\u4efb\u52a1\u7ec4\u4e2d\u6240\u6709\u4efb\u52a1</li> <li>\u4efb\u52a1\u7ec4\u4e2d\u7684\u6bcf\u4e2a\u4efb\u52a1\u4f1a\u6709\u4e00\u4e2a\u7ec4\u5185\u5e8f\u53f7\uff08<code>ARRAYINDEX</code>\uff09\uff0c\u5728\u5404\u4efb\u52a1\u5185\u901a\u8fc7\u73af\u5883\u53d8\u91cf <code>SLURM_ARRAY_TASK_ID</code> \u8bbf\u95ee\u3002\u9700\u8981\u5355\u72ec\u53bb\u53d6\u6d88\u7ec4\u5185\u4efb\u52a1\u65f6\uff0c\u8bf7\u4f7f\u7528 <code>scancel ARRAYID_ARRAYINDEX</code> </li> <li>\u6b64\u9009\u9879\u63d0\u4f9b\u7684\u503c\uff0c\u5373\u4e3a\u4efb\u52a1\u7ec4\u4e2d\u4efb\u52a1\u7684\u5e8f\u53f7\u3002\u4f8b\u5982 <code>0-15</code> \u4f1a\u63d0\u4ea4 16 \u4e2a\u4efb\u52a1\uff1b\u8fd916\u4e2a\u4efb\u52a1\u5185\u73af\u5883\u53d8\u91cf <code>SLURM_ARRAY_TASK_ID</code> \u7684\u503c\u5206\u522b\u4e3a 0, 1, 2, ... 15\u3002</li> <li>\u5141\u8bb8\u7684\u53c2\u6570\u683c\u5f0f\uff1a<code>0-15</code> (0, 1, 2, ... 15), <code>0,1,2,3</code> , <code>0,1,6-8</code>, <code>0-15:4</code> (0, 4, 8, 12), <code>0-15%4</code> (\u63d0\u4ea4 16 \u4e2a\u4efb\u52a1\uff0c\u4f46\u662f\u53ea\u80fd\u6709 4 \u4e2a\u4efb\u52a1\u540c\u65f6\u8fd0\u884c)</li> <li>\u6700\u5c0f\u4efb\u52a1\u5e8f\u53f7\u4e3a 0</li> </ul> </li> <li><code>--output</code>: \uff08\u53ef\u9009\uff09\u4efb\u52a1\u7684\u8f93\u51fa\u6587\u4ef6<ul> <li>\u5bf9\u4e8e\u5355\u4efb\u52a1\uff0c<code>%j</code> \u8868\u793a\u4efb\u52a1 ID \u5360\u4f4d\u7b26\u3002\u5982\u679c\u4efb\u52a1 ID \u4e3a 10086\uff0c <code>--output %j.out</code> \u8868\u793a\u4efb\u52a1\u8f93\u51fa\u5230 <code>10086.out</code> </li> <li>\u5bf9\u4e8e\u591a\u4efb\u52a1\uff0c<code>%A</code> \u8868\u793a\u4efb\u52a1\u7ec4ID\uff0c<code>%a</code> \u8868\u793a\u7ec4\u5185\u5e8f\u53f7\u3002\u5982\u679c\u4efb\u52a1\u7ec4 ID \u4e3a 10086\uff0c\u67d0\u4efb\u52a1\u7ec4\u5185\u5e8f\u53f7\u4e3a 4 \uff0c<code>--output %A_%a.out</code> \u8868\u793a\u4efb\u52a1\u8f93\u51fa\u5230 <code>10086_4.out</code></li> <li>\u5bf9\u4e8e\u5355\u4efb\u52a1\uff0c\u9ed8\u8ba4\u8f93\u51fa\u4e3a <code>slurm-%j.out</code></li> <li>\u5bf9\u4e8e\u591a\u4efb\u52a1\uff0c\u9ed8\u8ba4\u8f93\u51fa\u4e3a <code>slurm-%A_%a.out</code></li> <li>\u5982\u679c\u6307\u5b9a\u901a\u77e5\u90ae\u7bb1\uff0c\u4efb\u52a1\u7ed3\u675f\u65f6\uff0c\u7ed3\u675f\u901a\u77e5\u90ae\u4ef6\u4f1a\u5c06\u8f93\u51fa\u6587\u4ef6\u6700\u540e 100 \u884c\u968f\u90ae\u4ef6\u53d1\u9001\u81f3\u90ae\u7bb1</li> </ul> </li> <li><code>--mail-user</code>: \uff08\u53ef\u9009\uff09\u4efb\u52a1\u72b6\u6001\u53d8\u66f4\u65f6\uff0c\u63a5\u6536\u66f4\u65b0\u90ae\u4ef6\u7684\u90ae\u7bb1\u3002\u540c <code>srun</code> \u4e2d <code>--mail-user</code> </li> <li><code>--mail-type</code>: \uff08\u53ef\u9009\uff09\u5728\u4efb\u52a1\u72b6\u6001\u53d1\u751f\u54ea\u4e9b\u53d8\u5316\u65f6\uff0c\u53d1\u9001\u66f4\u65b0\u90ae\u4ef6\u3002\u540c <code>srun</code> \u4e2d <code>--mail-user</code> <ul> <li><code>BEGIN</code>: \u4efb\u52a1\u4ece\u7b49\u5f85\u961f\u5217\u4e2d\u53d6\u51fa\uff0c\u5f00\u59cb\u8fd0\u884c\u65f6</li> <li><code>END</code>: \u4efb\u52a1\u6b63\u5e38\u7ed3\u675f\u65f6</li> <li><code>FAILURE</code>: \u4efb\u52a1\u5f02\u5e38\u9000\u51fa\u65f6</li> <li><code>ALL</code>: \u4ee5\u4e0a\u4e09\u79cd\u60c5\u51b5\u5747\u53d1\u9001\u72b6\u6001\u66f4\u65b0\u90ae\u4ef6</li> </ul> </li> </ul> <p>\u6837\u4f8b <code>run.sh</code> \u811a\u672c\u5982\u4e0b\uff1a</p> <pre><code>#!/bin/bash\n#SBATCH --job-name example                  # \u4efb\u52a1\u5728 squeue \u4e2d\u663e\u793a\u4efb\u52a1\u540d\u4e3a example\n#SBATCH --output %A_%a.out                  # \u4efb\u52a1\u8f93\u51fa\u91cd\u5b9a\u5411\u81f3 [\u4efb\u52a1\u7ec4id]_[\u7ec4\u5185\u5e8f\u53f7].out\n#SBATCH --gres gpu:a100:1                   # \u4efb\u52a1\u7533\u8bf7\u4f7f\u7528\u4e00\u5f20 A100 GPU\n#SBATCH --time 1-1:00:00                    # \u4efb\u52a1\u6700\u957f\u8fd0\u884c 1 \u5929 1 \u5c0f\u65f6\uff0c\u8d85\u65f6\u4efb\u52a1\u5c06\u88ab\u6740\u6b7b\n#SBATCH --array 0-15                        # \u63d0\u4ea4 16 \u4e2a\u4efb\u52a1\uff0c\u7ec4\u5185\u5e8f\u53f7\u5206\u522b\u4e3a 0,1,2,...15\n#SBATCH --mail-user example@gmail.com       # \u5c06\u4efb\u52a1\u72b6\u6001\u66f4\u65b0\u4ee5\u90ae\u4ef6\u5f62\u5f0f\u53d1\u9001\u81f3 example@gmail.com\n#SBATCH --mail-type ALL                     # \u4efb\u52a1\u5f00\u59cb\u8fd0\u884c\u3001\u6b63\u5e38\u7ed3\u675f\u3001\u5f02\u5e38\u9000\u51fa\u65f6\u5747\u53d1\u9001\u90ae\u4ef6\u901a\u77e5\n# \u4efb\u52a1 ID \u901a\u8fc7 SLURM_ARRAY_TASK_ID \u73af\u5883\u53d8\u91cf\u8bbf\u95ee\n# \u4e0a\u8ff0\u884c\u6307\u5b9a\u53c2\u6570\u5c06\u4f20\u9012\u7ed9 sbatch \u4f5c\u4e3a\u547d\u4ee4\u884c\u53c2\u6570\n# \u4e2d\u95f4\u4e0d\u53ef\u4ee5\u6709\u975e #SBATCH \u5f00\u5934\u7684\u884c\n# \u6267\u884c sbatch \u547d\u4ee4\u524d\u5148\u901a\u8fc7 conda activate [env_name] \u8fdb\u5165\u73af\u5883\n# \u6267\u884c\u7a0b\u5e8f\necho ${SLURM_ARRAY_TASK_ID}\npython -V\npython -c \"print ('Hello, world!')\"\n</code></pre>"},{"location":"vnc/","title":"VNC","text":"<p>\u200b   \u8fd0\u7ef4\u56e2\u961f\u5728 AIR \u7684\u90e8\u5206\u670d\u52a1\u5668\u4e0a\u5b89\u88c5\u4e86\u53ef\u89c6\u5316\u56fe\u5f62\u754c\u9762\uff0c\u53ef\u4ee5\u4f7f\u7528\u652f\u6301 VNC \u534f\u8bae\u7684\u5ba2\u6237\u7aef\u8fde\u5165\u3002\u672c\u6587\u4fbf\u662f\u5bf9\u5176\u4f7f\u7528\u65b9\u6cd5\u7684\u7b80\u5355\u8bf4\u660e\u3002</p> <p>\u200b   \u76ee\u524d\u5b89\u88c5\u4e86 VNC Server \u7684\u670d\u52a1\u5668\u6709\uff1a</p> <ul> <li>10.0.0.14</li> <li>10.0.0.15</li> <li>10.0.0.21</li> <li>10.0.0.22</li> </ul>"},{"location":"vnc/#1-vnc-server","title":"1. \u914d\u7f6e VNC Server","text":"<p>\u200b   \u5982\u679c\u60a8\u4e4b\u524d\u6ca1\u6709\u914d\u7f6e\u8fc7 VNC Server\uff0c\u9996\u5148 SSH \u5230\u4e0a\u8ff0\u670d\u52a1\u5668\u4e2d\uff0c\u7136\u540e\u8f93\u5165\uff1a</p> <pre><code>vncserver -localhost no\n</code></pre> <p>\u200b   \u60a8\u53ef\u80fd\u4f1a\u770b\u5230\u7c7b\u4f3c\u4e8e\u5982\u4e0b\u7684\u63d0\u793a\uff1a</p> <pre><code>Warning: discover-01:5 is taken because of /tmp/.X5-lock\nRemove this file if there is no X server discover-01:5\n\nWarning: discover-01:8 is taken because of /tmp/.X8-lock\nRemove this file if there is no X server discover-01:8\n\nNew 'X' desktop is discover-01:27\n\nStarting applications specified in /home/gaoha/.vnc/xstartup\nLog file is /home/gaoha/.vnc/discover-01:27.log\n</code></pre> <p>\u200b   \u6ce8\u610f\u8fd9\u91cc <code>New 'X' desktop is discover-01:27</code> \u8bf4\u660e\u6211\u4eec\u7684 VNC \u8bc6\u522b\u53f7\u4e3a 27\uff0c\u8bf7\u6682\u65f6\u8bb0\u4f4f\u8fd9\u4e2a ID\u3002</p> <p>\u200b   \u63a5\u7740\uff0c\u6211\u4eec\u8981\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u4f7f\u5f97\u9ed8\u8ba4\u6253\u5f00 gnome \u684c\u9762\u3002\u5728\u6b64\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u5c06\u4e0a\u8ff0\u6253\u5f00\u7684\u670d\u52a1\u7aef\u5173\u95ed\uff1a</p> <pre><code>vncserver -kill :27\n</code></pre> <p>\u200b   \u901a\u8fc7\u6307\u5b9a\u4e0a\u8ff0\u8bc6\u522b ID\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u7ed3\u675f\u4e00\u4e2a VNC \u670d\u52a1\u7aef\u8fdb\u7a0b\u3002</p> <p>\u200b   \u6211\u4eec\u4f7f\u7528\u6587\u672c\u7f16\u8f91\u5668\u6253\u5f00 <code>~/.vnc/xstartup</code>\uff1a</p> <pre><code># Use nano or vim as you like\nnano ~/.vnc/xstartup\nvim ~/.vnc/xstartup\n</code></pre> <p>\u200b   \u5c06\u5176\u4fee\u6539\u4e3a\uff1a</p> <pre><code>#!/bin/sh\nunset SESSION_MANAGER\nxrdb $HOME/.Xresources\nvncconfig -iconic &amp;\ndbus-launch --exit-with-session gnome-session &amp;\n</code></pre> <p>\u63a5\u7740\uff0c\u53ea\u9700\u4f7f\u7528 <code>vncserver -localhost no</code> \u91cd\u65b0\u542f\u52a8\u670d\u52a1\u7aef\u8fdb\u7a0b\uff0c\u8bb0\u4f4f ID \u53f7\u5373\u53ef\u3002\u6ce8\u610f\u8fd9\u91cc\u8981\u63d0\u4f9b <code>-localhost no</code> \u8868\u793a\u5141\u8bb8\u975e\u672c\u673a\u5668\u8bbf\u95ee\u3002</p>"},{"location":"vnc/#2-vnc-viewer","title":"2. \u5b89\u88c5 VNC Viewer","text":"<p>\u200b   VNC Viewer \u662f\u652f\u6301 VNC \u534f\u8bae\u7684\u5ba2\u6237\u7aef\u3002\u6211\u4eec\u5df2\u5728\u4e0a\u8ff0\u670d\u52a1\u5668\u4e0a\u5b89\u88c5\u4e86\u670d\u52a1\u7aef\uff0c\u5728\u60a8\u7684\u7535\u8111\u4e0a\u8981\u505a\u7684\uff0c\u53ea\u6709\u5b89\u88c5 VNC Viewer \u8fd9\u4e00\u4ef6\u4e8b\u3002\u9009\u62e9\u9002\u7528\u4e8e\u60a8\u7cfb\u7edf\u7248\u672c\u7684\u5ba2\u6237\u7aef\uff0c\u8fdb\u884c\u5b89\u88c5\u5373\u53ef\u3002</p> <p></p> <p>\u200b   \u5728 VNC Viewer \u4e2d\u6dfb\u52a0\u670d\u52a1\u5668\uff0c\u5bf9\u7aef IP \u5730\u5740\u586b\u5165 <code>&lt;Server IP&gt;:&lt;ID&gt;</code>\uff0c\u63a5\u7740\u8fdb\u884c\u8fde\u63a5\u5373\u53ef\u3002</p> <p></p>"},{"location":"vpn/","title":"VPN","text":"<p>\u6625\u8282\u4e4b\u540e\u53ea\u80fd\u901a\u8fc7 VPN \u8bbf\u95ee\u96c6\u7fa4</p> <p>2022\u5e742\u67087\u65e5\u4e4b\u540e\uff0c\u96c6\u7fa4\u8d44\u6e90\u5c06\u53ea\u80fd\u901a\u8fc7 VPN \u8bbf\u95ee</p>"},{"location":"vpn/#1-vpn","title":"1. VPN \u4f7f\u7528\u65b9\u6cd5","text":"<p>\u6253\u5f00\u6d4f\u89c8\u5668\u8f93\u5165 https://103.242.175.254\uff0c\u70b9\u51fb\u4e0b\u8f7d</p> <p></p> <p>\u5b89\u88c5 aTrust \u5ba2\u6237\u7aef\uff1b\u5b89\u88c5\u5b8c\u6210\u540e\u8fdb\u5165\u7f51\u9875\u7aef\u8f93\u5165\u7528\u6237\u540d\u3001\u5bc6\u7801\u767b\u9646\u3002</p> <p>\u7528\u6237\u540d\u540c <code>slurm</code> \u96c6\u7fa4\u4e0a\u7684\u7528\u6237\u540d\uff08\u4e00\u822c\u4e3a\u59d3\u5168\u62fc+\u540d\u9996\u5b57\u6bcd\uff09\uff0c\u9ed8\u8ba4\u5bc6\u7801\u662f <code>Pass@1a2b3c</code></p>"},{"location":"vpn/#2-vpn","title":"2. VPN \u5185\u7f51\u8d44\u6e90","text":"<ol> <li><code>10.0.0.251</code> : Slurm \u96c6\u7fa4\u8df3\u677f\u673a</li> <li><code>10.0.0.242</code> : \u8c03\u8bd5\u673a</li> <li><code>10.0.0.3</code> : \u539f 8 * 3090 \u96c6\u7fa4</li> <li><code>10.0.0.1</code>: \u539f 10 * 3090 \u96c6\u7fa4</li> </ol> <p>\u8fde\u63a5 VPN \u540e\uff0c\u53ef\u6b63\u5e38\u901a\u8fc7 ssh \u7b49\u5de5\u5177\u8bbf\u95ee\u8d44\u6e90</p>"}]}